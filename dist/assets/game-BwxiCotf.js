import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as ot,s as pr}from"./mirage-S6-GZa0g.js";var en={},oo;function yr(){return oo||(oo=1,(function(){var c;function a(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var d=typeof Object.defineProperties=="function"?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};function w(e){e=[typeof globalThis=="object"&&globalThis,e,typeof window=="object"&&window,typeof self=="object"&&self,typeof ot=="object"&&ot];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}var x=w(this);function M(e,t){if(t)e:{var n=x;e=e.split(".");for(var o=0;o<e.length-1;o++){var r=e[o];if(!(r in n))break e;n=n[r]}e=e[e.length-1],o=n[e],t=t(o),t!=o&&t!=null&&d(n,e,{configurable:!0,writable:!0,value:t})}}M("Symbol",function(e){function t(s){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new n(o+(s||"")+"_"+r++,s)}function n(s,i){this.h=s,d(this,"description",{configurable:!0,writable:!0,value:i})}if(e)return e;n.prototype.toString=function(){return this.h};var o="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return t}),M("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<t.length;n++){var o=x[t[n]];typeof o=="function"&&typeof o.prototype[e]!="function"&&d(o.prototype,e,{configurable:!0,writable:!0,value:function(){return B(a(this))}})}return e});function B(e){return e={next:e},e[Symbol.iterator]=function(){return this},e}function S(e){var t=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:a(e)}}function F(e){if(!(e instanceof Array)){e=S(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}var U=typeof Object.assign=="function"?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var o=arguments[n];if(o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e};M("Object.assign",function(e){return e||U});var Q=typeof Object.create=="function"?Object.create:function(e){function t(){}return t.prototype=e,new t},ie;if(typeof Object.setPrototypeOf=="function")ie=Object.setPrototypeOf;else{var J;e:{var ce={a:!0},E={};try{E.__proto__=ce,J=E.a;break e}catch{}J=!1}ie=J?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var k=ie;function R(e,t){if(e.prototype=Q(t.prototype),e.prototype.constructor=e,k)k(e,t);else for(var n in t)if(n!="prototype")if(Object.defineProperties){var o=Object.getOwnPropertyDescriptor(t,n);o&&Object.defineProperty(e,n,o)}else e[n]=t[n];e.ya=t.prototype}function G(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function W(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}G.prototype.u=function(e){this.i=e};function $(e,t){e.l={ma:t,na:!0},e.h=e.s||e.v}G.prototype.return=function(e){this.l={return:e},this.h=this.v};function z(e,t,n){return e.h=n,{value:t}}function oe(e){this.h=new G,this.i=e}function ke(e,t){W(e.h);var n=e.h.j;return n?ye(e,"return"in n?n.return:function(o){return{value:o,done:!0}},t,e.h.return):(e.h.return(t),ne(e))}function ye(e,t,n,o){try{var r=t.call(e.h.j,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return e.h.m=!1,r;var s=r.value}catch(i){return e.h.j=null,$(e.h,i),ne(e)}return e.h.j=null,o.call(e.h,s),ne(e)}function ne(e){for(;e.h.h;)try{var t=e.i(e.h);if(t)return e.h.m=!1,{value:t.value,done:!1}}catch(n){e.h.i=void 0,$(e.h,n)}if(e.h.m=!1,e.h.l){if(t=e.h.l,e.h.l=null,t.na)throw t.ma;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function me(e){this.next=function(t){return W(e.h),e.h.j?t=ye(e,e.h.j.next,t,e.h.u):(e.h.u(t),t=ne(e)),t},this.throw=function(t){return W(e.h),e.h.j?t=ye(e,e.h.j.throw,t,e.h.u):($(e.h,t),t=ne(e)),t},this.return=function(t){return ke(e,t)},this[Symbol.iterator]=function(){return this}}function h(e){function t(o){return e.next(o)}function n(o){return e.throw(o)}return new Promise(function(o,r){function s(i){i.done?o(i.value):Promise.resolve(i.value).then(t,n).then(s,r)}s(e.next())})}function y(e){return h(new me(new oe(e)))}M("Promise",function(e){function t(i){this.i=0,this.j=void 0,this.h=[],this.u=!1;var l=this.l();try{i(l.resolve,l.reject)}catch(f){l.reject(f)}}function n(){this.h=null}function o(i){return i instanceof t?i:new t(function(l){l(i)})}if(e)return e;n.prototype.i=function(i){if(this.h==null){this.h=[];var l=this;this.j(function(){l.m()})}this.h.push(i)};var r=x.setTimeout;n.prototype.j=function(i){r(i,0)},n.prototype.m=function(){for(;this.h&&this.h.length;){var i=this.h;this.h=[];for(var l=0;l<i.length;++l){var f=i[l];i[l]=null;try{f()}catch(v){this.l(v)}}}this.h=null},n.prototype.l=function(i){this.j(function(){throw i})},t.prototype.l=function(){function i(v){return function(T){f||(f=!0,v.call(l,T))}}var l=this,f=!1;return{resolve:i(this.I),reject:i(this.m)}},t.prototype.I=function(i){if(i===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(i instanceof t)this.L(i);else{e:switch(typeof i){case"object":var l=i!=null;break e;case"function":l=!0;break e;default:l=!1}l?this.F(i):this.s(i)}},t.prototype.F=function(i){var l=void 0;try{l=i.then}catch(f){this.m(f);return}typeof l=="function"?this.M(l,i):this.s(i)},t.prototype.m=function(i){this.v(2,i)},t.prototype.s=function(i){this.v(1,i)},t.prototype.v=function(i,l){if(this.i!=0)throw Error("Cannot settle("+i+", "+l+"): Promise already settled in state"+this.i);this.i=i,this.j=l,this.i===2&&this.K(),this.H()},t.prototype.K=function(){var i=this;r(function(){if(i.D()){var l=x.console;typeof l<"u"&&l.error(i.j)}},1)},t.prototype.D=function(){if(this.u)return!1;var i=x.CustomEvent,l=x.Event,f=x.dispatchEvent;return typeof f>"u"?!0:(typeof i=="function"?i=new i("unhandledrejection",{cancelable:!0}):typeof l=="function"?i=new l("unhandledrejection",{cancelable:!0}):(i=x.document.createEvent("CustomEvent"),i.initCustomEvent("unhandledrejection",!1,!0,i)),i.promise=this,i.reason=this.j,f(i))},t.prototype.H=function(){if(this.h!=null){for(var i=0;i<this.h.length;++i)s.i(this.h[i]);this.h=null}};var s=new n;return t.prototype.L=function(i){var l=this.l();i.T(l.resolve,l.reject)},t.prototype.M=function(i,l){var f=this.l();try{i.call(l,f.resolve,f.reject)}catch(v){f.reject(v)}},t.prototype.then=function(i,l){function f(j,b){return typeof j=="function"?function(_){try{v(j(_))}catch(Y){T(Y)}}:b}var v,T,O=new t(function(j,b){v=j,T=b});return this.T(f(i,v),f(l,T)),O},t.prototype.catch=function(i){return this.then(void 0,i)},t.prototype.T=function(i,l){function f(){switch(v.i){case 1:i(v.j);break;case 2:l(v.j);break;default:throw Error("Unexpected state: "+v.i)}}var v=this;this.h==null?s.i(f):this.h.push(f),this.u=!0},t.resolve=o,t.reject=function(i){return new t(function(l,f){f(i)})},t.race=function(i){return new t(function(l,f){for(var v=S(i),T=v.next();!T.done;T=v.next())o(T.value).T(l,f)})},t.all=function(i){var l=S(i),f=l.next();return f.done?o([]):new t(function(v,T){function O(_){return function(Y){j[_]=Y,b--,b==0&&v(j)}}var j=[],b=0;do j.push(void 0),b++,o(f.value).T(O(j.length-1),T),f=l.next();while(!f.done)})},t});function I(e,t){e instanceof String&&(e+="");var n=0,o=!1,r={next:function(){if(!o&&n<e.length){var s=n++;return{value:t(s,e[s]),done:!1}}return o=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}M("Array.prototype.keys",function(e){return e||function(){return I(this,function(t){return t})}}),M("Array.prototype.fill",function(e){return e||function(t,n,o){var r=this.length||0;for(0>n&&(n=Math.max(0,r+n)),(o==null||o>r)&&(o=r),o=Number(o),0>o&&(o=Math.max(0,r+o)),n=Number(n||0);n<o;n++)this[n]=t;return this}});function C(e){return e||Array.prototype.fill}M("Int8Array.prototype.fill",C),M("Uint8Array.prototype.fill",C),M("Uint8ClampedArray.prototype.fill",C),M("Int16Array.prototype.fill",C),M("Uint16Array.prototype.fill",C),M("Int32Array.prototype.fill",C),M("Uint32Array.prototype.fill",C),M("Float32Array.prototype.fill",C),M("Float64Array.prototype.fill",C),M("Object.is",function(e){return e||function(t,n){return t===n?t!==0||1/t===1/n:t!==t&&n!==n}}),M("Array.prototype.includes",function(e){return e||function(t,n){var o=this;o instanceof String&&(o=String(o));var r=o.length;for(n=n||0,0>n&&(n=Math.max(n+r,0));n<r;n++){var s=o[n];if(s===t||Object.is(s,t))return!0}return!1}}),M("String.prototype.includes",function(e){return e||function(t,n){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(t,n||0)!==-1}});var X=this||self;function ee(e,t){e=e.split(".");var n=X;e[0]in n||typeof n.execScript>"u"||n.execScript("var "+e[0]);for(var o;e.length&&(o=e.shift());)e.length||t===void 0?n[o]&&n[o]!==Object.prototype[o]?n=n[o]:n=n[o]={}:n[o]=t}function g(e){var t;e:{if((t=X.navigator)&&(t=t.userAgent))break e;t=""}return t.indexOf(e)!=-1}var L=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var n=e.length,o=Array(n),r=typeof e=="string"?e.split(""):e,s=0;s<n;s++)s in r&&(o[s]=t.call(void 0,r[s],s,e));return o},V={},Z=null;function ue(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):"=.".indexOf(e[t-1])!=-1&&(n="=.".indexOf(e[t-2])!=-1?n-2:n-1);var o=new Uint8Array(n),r=0;return Re(e,function(s){o[r++]=s}),r!==n?o.subarray(0,r):o}function Re(e,t){function n(f){for(;o<e.length;){var v=e.charAt(o++),T=Z[v];if(T!=null)return T;if(!/^[\s\xa0]*$/.test(v))throw Error("Unknown base64 encoding at char: "+v)}return f}fe();for(var o=0;;){var r=n(-1),s=n(0),i=n(64),l=n(64);if(l===64&&r===-1)break;t(r<<2|s>>4),i!=64&&(t(s<<4&240|i>>2),l!=64&&t(i<<6&192|l))}}function fe(){if(!Z){Z={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var o=e.concat(t[n].split(""));V[n]=o;for(var r=0;r<o.length;r++){var s=o[r];Z[s]===void 0&&(Z[s]=r)}}}}var he=typeof Uint8Array<"u",xe=!(g("Trident")||g("MSIE"))&&typeof X.btoa=="function";function Me(e){if(!xe){var t;t===void 0&&(t=0),fe(),t=V[t];for(var n=Array(Math.floor(e.length/3)),o=t[64]||"",r=0,s=0;r<e.length-2;r+=3){var i=e[r],l=e[r+1],f=e[r+2],v=t[i>>2];i=t[(i&3)<<4|l>>4],l=t[(l&15)<<2|f>>6],f=t[f&63],n[s++]=v+i+l+f}switch(v=0,f=o,e.length-r){case 2:v=e[r+1],f=t[(v&15)<<2]||o;case 1:e=e[r],n[s]=t[e>>2]+t[(e&3)<<4|v>>4]+f+o}return n.join("")}for(t="";10240<e.length;)t+=String.fromCharCode.apply(null,e.subarray(0,10240)),e=e.subarray(10240);return t+=String.fromCharCode.apply(null,e),btoa(t)}var Oe=RegExp("[-_.]","g");function Ke(e){switch(e){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function De(e){if(!xe)return ue(e);Oe.test(e)&&(e=e.replace(Oe,Ke)),e=atob(e);for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}var Ne;function se(){return Ne||(Ne=new Uint8Array(0))}var D={},m=typeof Uint8Array.prototype.slice=="function",p=0,u=0;function H(e){var t=0>e;e=Math.abs(e);var n=e>>>0;e=Math.floor((e-n)/4294967296),t&&(n=S(N(n,e)),t=n.next().value,e=n.next().value,n=t),p=n>>>0,u=e>>>0}var P=typeof BigInt=="function";function N(e,t){return t=~t,e?e=~e+1:t+=1,[e,t]}function ae(e,t){this.i=e>>>0,this.h=t>>>0}function le(e){if(!e)return ze||(ze=new ae(0,0));if(!/^-?\d+$/.test(e))return null;if(16>e.length)H(Number(e));else if(P)e=BigInt(e),p=Number(e&BigInt(4294967295))>>>0,u=Number(e>>BigInt(32)&BigInt(4294967295));else{var t=+(e[0]==="-");u=p=0;for(var n=e.length,o=t,r=(n-t)%6+t;r<=n;o=r,r+=6)o=Number(e.slice(o,r)),u*=1e6,p=1e6*p+o,4294967296<=p&&(u+=p/4294967296|0,p%=4294967296);t&&(t=S(N(p,u)),e=t.next().value,t=t.next().value,p=e,u=t)}return new ae(p,u)}var ze;function _e(e,t){return Error("Invalid wire type: "+e+" (at position "+t+")")}function Pt(){return Error("Failed to read varint, encoding is invalid.")}function un(e,t){return Error("Tried to read past the end of the data "+t+" > "+e)}function Ue(){throw Error("Invalid UTF8")}function fn(e,t){return t=String.fromCharCode.apply(null,t),e==null?t:e+t}var yt=void 0,Lt,So=typeof TextDecoder<"u",hn,ko=typeof TextEncoder<"u",dn;function pn(e){if(e!==D)throw Error("illegal external caller")}function it(e,t){if(pn(t),this.V=e,e!=null&&e.length===0)throw Error("ByteString should be constructed with non-empty values")}function zt(){return dn||(dn=new it(null,D))}function yn(e){pn(D);var t=e.V;return t=t==null||he&&t!=null&&t instanceof Uint8Array?t:typeof t=="string"?De(t):null,t==null?t:e.V=t}function Go(e){if(typeof e=="string")return{buffer:De(e),C:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Uint8Array)return{buffer:e,C:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),C:!1};if(e.constructor===it)return{buffer:yn(e)||se(),C:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function mn(e,t){this.i=null,this.m=!1,this.h=this.j=this.l=0,It(this,e,t)}function It(e,t,n){n=n===void 0?{}:n,e.S=n.S===void 0?!1:n.S,t&&(t=Go(t),e.i=t.buffer,e.m=t.C,e.l=0,e.j=e.i.length,e.h=e.l)}mn.prototype.reset=function(){this.h=this.l};function We(e,t){if(e.h=t,t>e.j)throw un(e.j,t)}function st(e){var t=e.i,n=e.h,o=t[n++],r=o&127;if(o&128&&(o=t[n++],r|=(o&127)<<7,o&128&&(o=t[n++],r|=(o&127)<<14,o&128&&(o=t[n++],r|=(o&127)<<21,o&128&&(o=t[n++],r|=o<<28,o&128&&t[n++]&128&&t[n++]&128&&t[n++]&128&&t[n++]&128&&t[n++]&128)))))throw Pt();return We(e,n),r}function En(e,t){if(0>t)throw Error("Tried to read a negative byte length: "+t);var n=e.h,o=n+t;if(o>e.j)throw un(t,e.j-n);return e.h=o,n}var wn=[];function Ot(){this.h=[]}Ot.prototype.length=function(){return this.h.length},Ot.prototype.end=function(){var e=this.h;return this.h=[],e};function vn(e,t,n){for(;0<n||127<t;)e.h.push(t&127|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.h.push(t)}function Ve(e,t){for(;127<t;)e.h.push(t&127|128),t>>>=7;e.h.push(t)}function _t(e,t){if(wn.length){var n=wn.pop();It(n,e,t),e=n}else e=new mn(e,t);this.h=e,this.j=this.h.h,this.i=this.l=-1,this.setOptions(t)}_t.prototype.setOptions=function(e){e=e===void 0?{}:e,this.ca=e.ca===void 0?!1:e.ca},_t.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function gn(e){var t=e.h;if(t.h==t.j)return!1;e.j=e.h.h;var n=st(e.h)>>>0;if(t=n>>>3,n&=7,!(0<=n&&5>=n))throw _e(n,e.j);if(1>t)throw Error("Invalid field number: "+t+" (at position "+e.j+")");return e.l=t,e.i=n,!0}function mt(e){switch(e.i){case 0:if(e.i!=0)mt(e);else e:{e=e.h;for(var t=e.h,n=t+10,o=e.i;t<n;)if((o[t++]&128)===0){We(e,t);break e}throw Pt()}break;case 1:e=e.h,We(e,e.h+8);break;case 2:e.i!=2?mt(e):(t=st(e.h)>>>0,e=e.h,We(e,e.h+t));break;case 5:e=e.h,We(e,e.h+4);break;case 3:t=e.l;do{if(!gn(e))throw Error("Unmatched start-group tag: stream EOF");if(e.i==4){if(e.l!=t)throw Error("Unmatched end-group tag");break}mt(e)}while(!0);break;default:throw _e(e.i,e.j)}}var Et=[];function Ao(){this.j=[],this.i=0,this.h=new Ot}function Je(e,t){t.length!==0&&(e.j.push(t),e.i+=t.length)}function Bo(e,t){if(t=t.R){Je(e,e.h.end());for(var n=0;n<t.length;n++)Je(e,yn(t[n])||se())}}var Ie=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Ye(e,t){return Ie?e[Ie]|=t:e.A!==void 0?e.A|=t:(Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}}),t)}function xn(e,t){Ie?e[Ie]&&(e[Ie]&=~t):e.A!==void 0&&(e.A&=~t)}function re(e){var t;return Ie?t=e[Ie]:t=e.A,t??0}function Ge(e,t){Ie?e[Ie]=t:e.A!==void 0?e.A=t:Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}})}function Ft(e){return Ye(e,1),e}function Co(e,t){Ge(t,(e|0)&-51)}function wt(e,t){Ge(t,(e|18)&-41)}var Dt={};function vt(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&e.constructor===Object}var at,Mn=[];Ge(Mn,23),at=Object.freeze(Mn);function Nt(e){if(re(e.o)&2)throw Error("Cannot mutate an immutable Message")}function Ut(e){var t=e.length;(t=t?e[t-1]:void 0)&&vt(t)?t.g=1:(t={},e.push((t.g=1,t)))}function Tn(e){var t=e.i+e.G;return e.B||(e.B=e.o[t]={})}function He(e,t){return t===-1?null:t>=e.i?e.B?e.B[t]:void 0:e.o[t+e.G]}function Ae(e,t,n,o){Nt(e),lt(e,t,n,o)}function lt(e,t,n,o){e.j&&(e.j=void 0),t>=e.i||o?Tn(e)[t]=n:(e.o[t+e.G]=n,(e=e.B)&&t in e&&delete e[t])}function Wt(e,t,n,o){var r=He(e,t);Array.isArray(r)||(r=at);var s=re(r);if(s&1||Ft(r),o)s&2||Ye(r,2),n&1||Object.freeze(r);else{o=!(n&2);var i=s&2;n&1||!i?o&&s&16&&!i&&xn(r,16):(r=Ft(Array.prototype.slice.call(r)),lt(e,t,r))}return r}function Vt(e,t){var n=He(e,t),o=n==null?n:typeof n=="number"||n==="NaN"||n==="Infinity"||n==="-Infinity"?Number(n):void 0;return o!=null&&o!==n&&lt(e,t,o),o}function Rn(e,t,n,o,r){e.h||(e.h={});var s=e.h[n],i=Wt(e,n,3,r);if(!s){var l=i;s=[];var f=!!(re(e.o)&16);i=!!(re(l)&2);var v=l;!r&&i&&(l=Array.prototype.slice.call(l));for(var T=i,O=0;O<l.length;O++){var j=l[O],b=t,_=!1;if(_=_===void 0?!1:_,j=Array.isArray(j)?new b(j):_?new b:void 0,j!==void 0){b=j.o;var Y=_=re(b);i&&(Y|=2),f&&(Y|=16),Y!=_&&Ge(b,Y),b=Y,T=T||!!(2&b),s.push(j)}}return e.h[n]=s,f=re(l),t=f|33,t=T?t&-9:t|8,f!=t&&(T=l,Object.isFrozen(T)&&(T=Array.prototype.slice.call(T)),Ge(T,t),l=T),v!==l&&lt(e,n,l),(r||o&&i)&&Ye(s,2),o&&Object.freeze(s),s}return r||(r=Object.isFrozen(s),o&&!r?Object.freeze(s):!o&&r&&(s=Array.prototype.slice.call(s),e.h[n]=s)),s}function gt(e,t,n){var o=!!(re(e.o)&2);if(t=Rn(e,t,n,o,o),e=Wt(e,n,3,o),!(o||re(e)&8)){for(o=0;o<t.length;o++){if(n=t[o],re(n.o)&2){var r=An(n,!1);r.j=n}else r=n;n!==r&&(t[o]=r,e[o]=r.o)}Ye(e,8)}return t}function Be(e,t,n){if(n!=null&&typeof n!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof n+": "+n);Ae(e,t,n)}function Hn(e,t,n,o,r){Nt(e);var s=Rn(e,n,t,!1,!1);return n=o??new n,e=Wt(e,t,2,!1),r!=null?(s.splice(r,0,n),e.splice(r,0,n.o)):(s.push(n),e.push(n.o)),n.C()&&xn(e,8),n}function xt(e,t){return e??t}function Ce(e,t,n){return n=n===void 0?0:n,xt(Vt(e,t),n)}var Mt;function jo(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":if(e)if(Array.isArray(e)){if((re(e)&128)!==0)return e=Array.prototype.slice.call(e),Ut(e),e}else{if(he&&e!=null&&e instanceof Uint8Array)return Me(e);if(e instanceof it){var t=e.V;return t==null?"":typeof t=="string"?t:e.V=Me(t)}}}return e}function bn(e,t,n,o){if(e!=null){if(Array.isArray(e))e=Yt(e,t,n,o!==void 0);else if(vt(e)){var r={},s;for(s in e)r[s]=bn(e[s],t,n,o);e=r}else e=t(e,o);return e}}function Yt(e,t,n,o){var r=re(e);o=o?!!(r&16):void 0,e=Array.prototype.slice.call(e);for(var s=0;s<e.length;s++)e[s]=bn(e[s],t,n,o);return n(r,e),e}function Po(e){return e.ja===Dt?e.toJSON():jo(e)}function Lo(e,t){e&128&&Ut(t)}function Sn(e,t,n){if(n=n===void 0?wt:n,e!=null){if(he&&e instanceof Uint8Array)return e.length?new it(new Uint8Array(e),D):zt();if(Array.isArray(e)){var o=re(e);return o&2?e:t&&!(o&32)&&(o&16||o===0)?(Ge(e,o|2),e):(e=Yt(e,Sn,o&4?wt:n,!0),t=re(e),t&4&&t&2&&Object.freeze(e),e)}return e.ja===Dt?Gn(e):e}}function kn(e,t,n,o,r,s,i){if(e=e.h&&e.h[n]){if(o=re(e),o&2?o=e:(s=L(e,Gn),wt(o,s),Object.freeze(s),o=s),Nt(t),i=o==null?at:Ft([]),o!=null){for(s=!!o.length,e=0;e<o.length;e++){var l=o[e];s=s&&!(re(l.o)&2),i[e]=l.o}s=(s?8:0)|1,e=re(i),(e&s)!==s&&(Object.isFrozen(i)&&(i=Array.prototype.slice.call(i)),Ge(i,e|s)),t.h||(t.h={}),t.h[n]=o}else t.h&&(t.h[n]=void 0);lt(t,n,i,r)}else Ae(t,n,Sn(o,s,i),r)}function Gn(e){return re(e.o)&2||(e=An(e,!0),Ye(e.o,2)),e}function An(e,t){var n=e.o,o=[];Ye(o,16);var r=e.constructor.h;if(r&&o.push(r),r=e.B,r){o.length=n.length,o.fill(void 0,o.length,n.length);var s={};o[o.length-1]=s}(re(n)&128)!==0&&Ut(o),t=t||e.C()?wt:Co,s=e.constructor,Mt=o,o=new s(o),Mt=void 0,e.R&&(o.R=e.R.slice()),s=!!(re(n)&16);for(var i=r?n.length-1:n.length,l=0;l<i;l++)kn(e,o,l-e.G,n[l],!1,s,t);if(r)for(var f in r)kn(e,o,+f,r[f],!0,s,t);return o}function Ee(e,t,n){e==null&&(e=Mt),Mt=void 0;var o=this.constructor.i||0,r=0<o,s=this.constructor.h,i=!1;if(e==null){e=s?[s]:[];var l=48,f=!0;r&&(o=0,l|=128),Ge(e,l)}else{if(!Array.isArray(e)||s&&s!==e[0])throw Error();var v=l=Ye(e,0);if((f=(16&v)!==0)&&((i=(32&v)!==0)||(v|=32)),r){if(128&v)o=0;else if(0<e.length){var T=e[e.length-1];if(vt(T)&&"g"in T){o=0,v|=128,delete T.g;var O=!0,j;for(j in T){O=!1;break}O&&e.pop()}}}else if(128&v)throw Error();l!==v&&Ge(e,v)}this.G=(s?0:-1)-o,this.h=void 0,this.o=e;e:{if(s=this.o.length,o=s-1,s&&(s=this.o[o],vt(s))){this.B=s,this.i=o-this.G;break e}t!==void 0&&-1<t?(this.i=Math.max(t,o+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!r&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(n){t=f&&!i&&!0,r=this.i;var b;for(f=0;f<n.length;f++)i=n[f],i<r?(i+=this.G,(o=e[i])?Bn(o,t):e[i]=at):(b||(b=Tn(this)),(o=b[i])?Bn(o,t):b[i]=at)}}Ee.prototype.toJSON=function(){return Yt(this.o,Po,Lo)},Ee.prototype.C=function(){return!!(re(this.o)&2)};function Bn(e,t){if(Array.isArray(e)){var n=re(e),o=1;!t||n&2||(o|=16),(n&o)!==o&&Ge(e,n|o)}}Ee.prototype.ja=Dt,Ee.prototype.toString=function(){return this.o.toString()};function Cn(e,t,n){if(n){var o={},r;for(r in n){var s=n[r],i=s.qa;i||(o.J=s.wa||s.oa.W,s.ia?(o.aa=In(s.ia),i=(function(l){return function(f,v,T){return l.J(f,v,T,l.aa)}})(o)):s.ka?(o.Z=On(s.da.P,s.ka),i=(function(l){return function(f,v,T){return l.J(f,v,T,l.Z)}})(o)):i=o.J,s.qa=i),i(t,e,s.da),o={J:o.J,aa:o.aa,Z:o.Z}}}Bo(t,e)}var Tt=Symbol();function jn(e,t,n){return e[Tt]||(e[Tt]=function(o,r){return t(o,r,n)})}function Pn(e){var t=e[Tt];if(!t){var n=Xt(e);t=function(o,r){return _n(o,r,n)},e[Tt]=t}return t}function zo(e){var t=e.ia;if(t)return Pn(t);if(t=e.va)return jn(e.da.P,t,e.ka)}function Io(e){var t=zo(e),n=e.da,o=e.oa.U;return t?function(r,s){return o(r,s,n,t)}:function(r,s){return o(r,s,n)}}function Ln(e,t){var n=e[t];return typeof n=="function"&&n.length===0&&(n=n(),e[t]=n),Array.isArray(n)&&(ut in n||ct in n||0<n.length&&typeof n[0]=="function")?n:void 0}function zn(e,t,n,o,r,s){t.P=e[0];var i=1;if(e.length>i&&typeof e[i]!="number"){var l=e[i++];n(t,l)}for(;i<e.length;){n=e[i++];for(var f=i+1;f<e.length&&typeof e[f]!="number";)f++;switch(l=e[i++],f-=i,f){case 0:o(t,n,l);break;case 1:(f=Ln(e,i))?(i++,r(t,n,l,f)):o(t,n,l,e[i++]);break;case 2:f=i++,f=Ln(e,f),r(t,n,l,f,e[i++]);break;case 3:s(t,n,l,e[i++],e[i++],e[i++]);break;case 4:s(t,n,l,e[i++],e[i++],e[i++],e[i++]);break;default:throw Error("unexpected number of binary field arguments: "+f)}}return t}var Rt=Symbol();function In(e){var t=e[Rt];if(!t){var n=$t(e);t=function(o,r){return Fn(o,r,n)},e[Rt]=t}return t}function On(e,t){var n=e[Rt];return n||(n=function(o,r){return Cn(o,r,t)},e[Rt]=n),n}var ct=Symbol();function Oo(e,t){e.push(t)}function _o(e,t,n){e.push(t,n.W)}function Fo(e,t,n,o){var r=In(o),s=$t(o).P,i=n.W;e.push(t,function(l,f,v){return i(l,f,v,s,r)})}function Do(e,t,n,o,r,s){var i=On(o,s),l=n.W;e.push(t,function(f,v,T){return l(f,v,T,o,i)})}function $t(e){var t=e[ct];return t||(t=zn(e,e[ct]=[],Oo,_o,Fo,Do),ut in e&&ct in e&&(e.length=0),t)}var ut=Symbol();function No(e,t){e[0]=t}function Uo(e,t,n,o){var r=n.U;e[t]=o?function(s,i,l){return r(s,i,l,o)}:r}function Wo(e,t,n,o,r){var s=n.U,i=Pn(o),l=Xt(o).P;e[t]=function(f,v,T){return s(f,v,T,l,i,r)}}function Vo(e,t,n,o,r,s,i){var l=n.U,f=jn(o,r,s);e[t]=function(v,T,O){return l(v,T,O,o,f,i)}}function Xt(e){var t=e[ut];return t||(t=zn(e,e[ut]={},No,Uo,Wo,Vo),ut in e&&ct in e&&(e.length=0),t)}function _n(e,t,n){for(;gn(t)&&t.i!=4;){var o=t.l,r=n[o];if(!r){var s=n[0];s&&(s=s[o])&&(r=n[o]=Io(s))}if(!r||!r(t,e,o)){r=t,o=e,s=r.j,mt(r);var i=r;if(!i.ca){if(r=i.h.h-s,i.h.h=s,i=i.h,r==0)r=zt();else{if(s=En(i,r),i.S&&i.m)r=i.i.subarray(s,s+r);else{i=i.i;var l=s;r=s+r,r=l===r?se():m?i.slice(l,r):new Uint8Array(i.subarray(l,r))}r=r.length==0?zt():new it(r,D)}(s=o.R)?s.push(r):o.R=[r]}}}return e}function Fn(e,t,n){for(var o=n.length,r=o%2==1,s=r?1:0;s<o;s+=2)(0,n[s+1])(t,e,n[s]);Cn(e,t,r?n[0]:void 0)}function ft(e,t){return{U:e,W:t}}var be=ft(function(e,t,n){if(e.i!==5)return!1;e=e.h;var o=e.i,r=e.h,s=o[r],i=o[r+1],l=o[r+2];return o=o[r+3],We(e,e.h+4),i=(s<<0|i<<8|l<<16|o<<24)>>>0,e=2*(i>>31)+1,s=i>>>23&255,i&=8388607,Ae(t,n,s==255?i?NaN:1/0*e:s==0?e*Math.pow(2,-149)*i:e*Math.pow(2,s-150)*(i+Math.pow(2,23))),!0},function(e,t,n){if(t=Vt(t,n),t!=null){Ve(e.h,8*n+5),e=e.h;var o=+t;o===0?0<1/o?p=u=0:(u=0,p=2147483648):isNaN(o)?(u=0,p=2147483647):(o=(n=0>o?-2147483648:0)?-o:o,34028234663852886e22<o?(u=0,p=(n|2139095040)>>>0):11754943508222875e-54>o?(o=Math.round(o/Math.pow(2,-149)),u=0,p=(n|o)>>>0):(t=Math.floor(Math.log(o)/Math.LN2),o*=Math.pow(2,-t),o=Math.round(8388608*o),16777216<=o&&++t,u=0,p=(n|t+127<<23|o&8388607)>>>0)),n=p,e.h.push(n>>>0&255),e.h.push(n>>>8&255),e.h.push(n>>>16&255),e.h.push(n>>>24&255)}}),Yo=ft(function(e,t,n){if(e.i!==0)return!1;var o=e.h,r=0,s=e=0,i=o.i,l=o.h;do{var f=i[l++];r|=(f&127)<<s,s+=7}while(32>s&&f&128);for(32<s&&(e|=(f&127)>>4),s=3;32>s&&f&128;s+=7)f=i[l++],e|=(f&127)<<s;if(We(o,l),128>f)o=r>>>0,f=e>>>0,(e=f&2147483648)&&(o=~o+1>>>0,f=~f>>>0,o==0&&(f=f+1>>>0)),o=4294967296*f+(o>>>0);else throw Pt();return Ae(t,n,e?-o:o),!0},function(e,t,n){t=He(t,n),t!=null&&(typeof t=="string"&&le(t),t!=null&&(Ve(e.h,8*n),typeof t=="number"?(e=e.h,H(t),vn(e,p,u)):(n=le(t),vn(e.h,n.i,n.h))))}),$o=ft(function(e,t,n){return e.i!==0?!1:(Ae(t,n,st(e.h)),!0)},function(e,t,n){if(t=He(t,n),t!=null&&t!=null)if(Ve(e.h,8*n),e=e.h,n=t,0<=n)Ve(e,n);else{for(t=0;9>t;t++)e.h.push(n&127|128),n>>=7;e.h.push(1)}}),Dn=ft(function(e,t,n){if(e.i!==2)return!1;var o=st(e.h)>>>0;e=e.h;var r=En(e,o);if(e=e.i,So){var s=e,i;(i=Lt)||(i=Lt=new TextDecoder("utf-8",{fatal:!0})),e=r+o,s=r===0&&e===s.length?s:s.subarray(r,e);try{var l=i.decode(s)}catch(O){if(yt===void 0){try{i.decode(new Uint8Array([128]))}catch{}try{i.decode(new Uint8Array([97])),yt=!0}catch{yt=!1}}throw!yt&&(Lt=void 0),O}}else{l=r,o=l+o,r=[];for(var f=null,v,T;l<o;)v=e[l++],128>v?r.push(v):224>v?l>=o?Ue():(T=e[l++],194>v||(T&192)!==128?(l--,Ue()):r.push((v&31)<<6|T&63)):240>v?l>=o-1?Ue():(T=e[l++],(T&192)!==128||v===224&&160>T||v===237&&160<=T||((s=e[l++])&192)!==128?(l--,Ue()):r.push((v&15)<<12|(T&63)<<6|s&63)):244>=v?l>=o-2?Ue():(T=e[l++],(T&192)!==128||(v<<28)+(T-144)>>30!==0||((s=e[l++])&192)!==128||((i=e[l++])&192)!==128?(l--,Ue()):(v=(v&7)<<18|(T&63)<<12|(s&63)<<6|i&63,v-=65536,r.push((v>>10&1023)+55296,(v&1023)+56320))):Ue(),8192<=r.length&&(f=fn(f,r),r.length=0);l=fn(f,r)}return Ae(t,n,l),!0},function(e,t,n){if(t=He(t,n),t!=null){var o=!1;if(o=o===void 0?!1:o,ko){if(o&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(t))throw Error("Found an unpaired surrogate");t=(hn||(hn=new TextEncoder)).encode(t)}else{for(var r=0,s=new Uint8Array(3*t.length),i=0;i<t.length;i++){var l=t.charCodeAt(i);if(128>l)s[r++]=l;else{if(2048>l)s[r++]=l>>6|192;else{if(55296<=l&&57343>=l){if(56319>=l&&i<t.length){var f=t.charCodeAt(++i);if(56320<=f&&57343>=f){l=1024*(l-55296)+f-56320+65536,s[r++]=l>>18|240,s[r++]=l>>12&63|128,s[r++]=l>>6&63|128,s[r++]=l&63|128;continue}else i--}if(o)throw Error("Found an unpaired surrogate");l=65533}s[r++]=l>>12|224,s[r++]=l>>6&63|128}s[r++]=l&63|128}}t=r===s.length?s:s.subarray(0,r)}Ve(e.h,8*n+2),Ve(e.h,t.length),Je(e,e.h.end()),Je(e,t)}}),Nn=ft(function(e,t,n,o,r){if(e.i!==2)return!1;t=Hn(t,n,o),n=e.h.j,o=st(e.h)>>>0;var s=e.h.h+o,i=s-n;if(0>=i&&(e.h.j=s,r(t,e,void 0,void 0,void 0),i=s-e.h.h),i)throw Error("Message parsing ended unexpectedly. Expected to read "+(o+" bytes, instead read "+(o-i)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return e.h.h=s,e.h.j=n,!0},function(e,t,n,o,r){if(t=gt(t,o,n),t!=null)for(o=0;o<t.length;o++){var s=e;Ve(s.h,8*n+2);var i=s.h.end();Je(s,i),i.push(s.i),s=i,r(t[o],e),i=e;var l=s.pop();for(l=i.i+i.h.length()-l;127<l;)s.push(l&127|128),l>>>=7,i.i++;s.push(l),i.i++}});function Kt(e){return function(t,n){e:{if(Et.length){var o=Et.pop();o.setOptions(n),It(o.h,t,n),t=o}else t=new _t(t,n);try{var r=Xt(e),s=_n(new r.P,t,r);break e}finally{r=t.h,r.i=null,r.m=!1,r.l=0,r.j=0,r.h=0,r.S=!1,t.l=-1,t.i=-1,100>Et.length&&Et.push(t)}s=void 0}return s}}function Jt(e){return function(){var t=new Ao;Fn(this,t,$t(e)),Je(t,t.h.end());for(var n=new Uint8Array(t.i),o=t.j,r=o.length,s=0,i=0;i<r;i++){var l=o[i];n.set(l,s),s+=l.length}return t.j=[n],n}}function Ze(e){Ee.call(this,e)}R(Ze,Ee);var Un=[Ze,1,$o,2,be,3,Dn,4,Dn];Ze.prototype.l=Jt(Un);function Zt(e){Ee.call(this,e,-1,Xo)}R(Zt,Ee),Zt.prototype.addClassification=function(e,t){return Hn(this,1,Ze,e,t),this};var Xo=[1],Wn=Kt([Zt,1,Nn,Un]);function Qe(e){Ee.call(this,e)}R(Qe,Ee);var Vn=[Qe,1,be,2,be,3,be,4,be,5,be];Qe.prototype.l=Jt(Vn);function Yn(e){Ee.call(this,e,-1,Ko)}R(Yn,Ee);var Ko=[1],$n=Kt([Yn,1,Nn,Vn]);function Ht(e){Ee.call(this,e)}R(Ht,Ee);var Xn=[Ht,1,be,2,be,3,be,4,be,5,be,6,Yo],Jo=Kt(Xn);Ht.prototype.l=Jt(Xn);function Kn(e,t,n){if(n=e.createShader(n===0?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+e.getShaderInfoLog(n));return n}function Jn(e){return gt(e,Ze,1).map(function(t){var n=He(t,1);return{index:n??0,score:Ce(t,2),label:He(t,3)!=null?xt(He(t,3),""):void 0,displayName:He(t,4)!=null?xt(He(t,4),""):void 0}})}function Zn(e){return{x:Ce(e,1),y:Ce(e,2),z:Ce(e,3),visibility:Vt(e,4)!=null?Ce(e,4):void 0}}function Qn(e){return e.map(function(t){return gt($n(t),Qe,1).map(Zn)})}function Qt(e,t){this.i=e,this.h=t,this.m=0}function qn(e,t,n){return Zo(e,t),typeof e.h.canvas.transferToImageBitmap=="function"?Promise.resolve(e.h.canvas.transferToImageBitmap()):n?Promise.resolve(e.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(e.h.canvas):(e.j===void 0&&(e.j=document.createElement("canvas")),new Promise(function(o){e.j.height=e.h.canvas.height,e.j.width=e.h.canvas.width,e.j.getContext("2d",{}).drawImage(e.h.canvas,0,0,e.h.canvas.width,e.h.canvas.height),o(e.j)}))}function Zo(e,t){var n=e.h;if(e.s===void 0){var o=Kn(n,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),r=Kn(n,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),s=n.createProgram();if(n.attachShader(s,o),n.attachShader(s,r),n.linkProgram(s),!n.getProgramParameter(s,n.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+n.getProgramInfoLog(s));o=e.s=s,n.useProgram(o),r=n.getUniformLocation(o,"sampler0"),e.l={O:n.getAttribLocation(o,"aVertex"),N:n.getAttribLocation(o,"aTex"),xa:r},e.v=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.enableVertexAttribArray(e.l.O),n.vertexAttribPointer(e.l.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),e.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.enableVertexAttribArray(e.l.N),n.vertexAttribPointer(e.l.N,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(r,0)}o=e.l,n.useProgram(e.s),n.canvas.width=t.width,n.canvas.height=t.height,n.viewport(0,0,t.width,t.height),n.activeTexture(n.TEXTURE0),e.i.bindTexture2d(t.glName),n.enableVertexAttribArray(o.O),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.vertexAttribPointer(o.O,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(o.N),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.vertexAttribPointer(o.N,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(o.O),n.disableVertexAttribArray(o.N),n.bindBuffer(n.ARRAY_BUFFER,null),e.i.bindTexture2d(0)}function Qo(e){this.h=e}var qo=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function er(e,t){return t+e}function eo(e,t){window[e]=t}function tr(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise(function(n){t.addEventListener("load",function(){n()},!1),t.addEventListener("error",function(){n()},!1),document.body.appendChild(t)})}function nr(){return y(function(e){switch(e.h){case 1:return e.s=2,z(e,WebAssembly.instantiate(qo),4);case 4:e.h=3,e.s=0;break;case 2:return e.s=0,e.l=null,e.return(!1);case 3:return e.return(!0)}})}function qt(e){if(this.h=e,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=e&&e.locateFile||er,typeof window=="object")var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=t,e.options){t=S(Object.keys(e.options));for(var n=t.next();!n.done;n=t.next()){n=n.value;var o=e.options[n].default;o!==void 0&&(this.l[n]=typeof o=="function"?o():o)}}}c=qt.prototype,c.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function or(e){var t,n,o,r,s,i,l,f,v,T,O;return y(function(j){switch(j.h){case 1:return e.ga?(t=e.h.files===void 0?[]:typeof e.h.files=="function"?e.h.files(e.l):e.h.files,z(j,nr(),2)):j.return();case 2:if(n=j.i,typeof window=="object")return eo("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),eo("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),i=t.filter(function(b){return b.data!==void 0}),l=t.filter(function(b){return b.data===void 0}),f=Promise.all(i.map(function(b){var _=bt(e,b.url);if(b.path!==void 0){var Y=b.path;_=_.then(function(te){return e.overrideFile(Y,te),Promise.resolve(te)})}return _})),v=Promise.all(l.map(function(b){return b.simd===void 0||b.simd&&n||!b.simd&&!n?tr(e.locateFile(b.url,e.ha)):Promise.resolve()})).then(function(){var b,_,Y;return y(function(te){if(te.h==1)return b=window.createMediapipeSolutionsWasm,_=window.createMediapipeSolutionsPackedAssets,Y=e,z(te,b(_),2);Y.i=te.i,te.h=0})}),T=(function(){return y(function(b){return e.h.graph&&e.h.graph.url?b=z(b,bt(e,e.h.graph.url),0):(b.h=0,b=void 0),b})})(),z(j,Promise.all([v,f,T]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return o=t.filter(function(b){return b.simd===void 0||b.simd&&n||!b.simd&&!n}).map(function(b){return e.locateFile(b.url,e.ha)}),importScripts.apply(null,F(o)),r=e,z(j,createMediapipeSolutionsWasm(Module),6);case 6:r.i=j.i,e.m=new OffscreenCanvas(1,1),e.i.canvas=e.m,s=e.i.GL.createContext(e.m,{antialias:!1,alpha:!1,ua:typeof WebGL2RenderingContext<"u"?2:1}),e.i.GL.makeContextCurrent(s),j.h=4;break;case 7:if(e.m=document.createElement("canvas"),O=e.m.getContext("webgl2",{}),!O&&(O=e.m.getContext("webgl",{}),!O))return alert("Failed to create WebGL canvas context when passing video frame."),j.return();e.K=O,e.i.canvas=e.m,e.i.createContext(e.m,!0,!0,{});case 4:e.j=new e.i.SolutionWasm,e.ga=!1,j.h=0}})}function rr(e){var t,n,o,r,s,i,l,f;return y(function(v){if(v.h==1){if(e.h.graph&&e.h.graph.url&&e.fa===e.h.graph.url)return v.return();if(e.u=!0,!e.h.graph||!e.h.graph.url){v.h=2;return}return e.fa=e.h.graph.url,z(v,bt(e,e.h.graph.url),3)}for(v.h!=2&&(t=v.i,e.j.loadGraph(t)),n=S(Object.keys(e.D)),o=n.next();!o.done;o=n.next())r=o.value,e.j.overrideFile(r,e.D[r]);if(e.D={},e.h.listeners)for(s=S(e.h.listeners),i=s.next();!i.done;i=s.next())l=i.value,lr(e,l);f=e.l,e.l={},e.setOptions(f),v.h=0})}c.reset=function(){var e=this;return y(function(t){e.j&&(e.j.reset(),e.s={},e.v={}),t.h=0})},c.setOptions=function(e,t){var n=this;if(t=t||this.h.options){for(var o=[],r=[],s={},i=S(Object.keys(e)),l=i.next();!l.done;s={X:s.X,Y:s.Y},l=i.next())if(l=l.value,!(l in this.l&&this.l[l]===e[l])){this.l[l]=e[l];var f=t[l];f!==void 0&&(f.onChange&&(s.X=f.onChange,s.Y=e[l],o.push((function(v){return function(){var T;return y(function(O){if(O.h==1)return z(O,v.X(v.Y),2);T=O.i,T===!0&&(n.u=!0),O.h=0})}})(s))),f.graphOptionXref&&(l=Object.assign({},{calculatorName:"",calculatorIndex:0},f.graphOptionXref,{valueNumber:f.type===1?e[l]:0,valueBoolean:f.type===0?e[l]:!1,valueString:f.type===2?e[l]:""}),r.push(l)))}(o.length!==0||r.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(r),this.F=(this.F===void 0?[]:this.F).concat(o))}};function ir(e){var t,n,o,r,s,i,l;return y(function(f){switch(f.h){case 1:if(!e.u)return f.return();if(!e.F){f.h=2;break}t=S(e.F),n=t.next();case 3:if(n.done){f.h=5;break}return o=n.value,z(f,o(),4);case 4:n=t.next(),f.h=3;break;case 5:e.F=void 0;case 2:if(e.H){for(r=new e.i.GraphOptionChangeRequestList,s=S(e.H),i=s.next();!i.done;i=s.next())l=i.value,r.push_back(l);e.j.changeOptions(r),r.delete(),e.H=void 0}e.u=!1,f.h=0}})}c.initialize=function(){var e=this;return y(function(t){return t.h==1?z(t,or(e),2):t.h!=3?z(t,rr(e),3):z(t,ir(e),0)})};function bt(e,t){var n,o;return y(function(r){return t in e.L?r.return(e.L[t]):(n=e.locateFile(t,""),o=fetch(n).then(function(s){return s.arrayBuffer()}),e.L[t]=o,r.return(o))})}c.overrideFile=function(e,t){this.j?this.j.overrideFile(e,t):this.D[e]=t},c.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},c.send=function(e,t){var n=this,o,r,s,i,l,f,v,T,O;return y(function(j){switch(j.h){case 1:return n.h.inputs?(o=1e3*(t??performance.now()),z(j,n.I,2)):j.return();case 2:return z(j,n.initialize(),3);case 3:for(r=new n.i.PacketDataList,s=S(Object.keys(e)),i=s.next();!i.done;i=s.next())if(l=i.value,f=n.h.inputs[l]){e:{var b=e[l];switch(f.type){case"video":var _=n.s[f.stream];if(_||(_=new Qt(n.i,n.K),n.s[f.stream]=_),_.m===0&&(_.m=_.i.createTexture()),typeof HTMLVideoElement<"u"&&b instanceof HTMLVideoElement)var Y=b.videoWidth,te=b.videoHeight;else typeof HTMLImageElement<"u"&&b instanceof HTMLImageElement?(Y=b.naturalWidth,te=b.naturalHeight):(Y=b.width,te=b.height);te={glName:_.m,width:Y,height:te},Y=_.h,Y.canvas.width=te.width,Y.canvas.height=te.height,Y.activeTexture(Y.TEXTURE0),_.i.bindTexture2d(_.m),Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,Y.UNSIGNED_BYTE,b),_.i.bindTexture2d(0),_=te;break e;case"detections":for(_=n.s[f.stream],_||(_=new Qo(n.i),n.s[f.stream]=_),_.data||(_.data=new _.h.DetectionListData),_.data.reset(b.length),te=0;te<b.length;++te){Y=b[te];var q=_.data,de=q.setBoundingBox,Te=te,we=Y.la,K=new Ht;if(Be(K,1,we.ra),Be(K,2,we.sa),Be(K,3,we.height),Be(K,4,we.width),Be(K,5,we.rotation),Ae(K,6,we.pa),we=K.l(),de.call(q,Te,we),Y.ea)for(q=0;q<Y.ea.length;++q){K=Y.ea[q],de=_.data,Te=de.addNormalizedLandmark,we=te,K=Object.assign({},K,{visibility:K.visibility?K.visibility:0});var pe=new Qe;Be(pe,1,K.x),Be(pe,2,K.y),Be(pe,3,K.z),K.visibility&&Be(pe,4,K.visibility),K=pe.l(),Te.call(de,we,K)}if(Y.ba)for(q=0;q<Y.ba.length;++q)de=_.data,Te=de.addClassification,we=te,K=Y.ba[q],pe=new Ze,Be(pe,2,K.score),K.index&&Ae(pe,1,K.index),K.label&&Ae(pe,3,K.label),K.displayName&&Ae(pe,4,K.displayName),K=pe.l(),Te.call(de,we,K)}_=_.data;break e;default:_={}}}switch(v=_,T=f.stream,f.type){case"video":r.pushTexture2d(Object.assign({},v,{stream:T,timestamp:o}));break;case"detections":O=v,O.stream=T,O.timestamp=o,r.pushDetectionList(O);break;default:throw Error("Unknown input config type: '"+f.type+"'")}}return n.j.send(r),z(j,n.I,4);case 4:r.delete(),j.h=0}})};function sr(e,t,n){var o,r,s,i,l,f,v,T,O,j,b,_,Y,te;return y(function(q){switch(q.h){case 1:if(!n)return q.return(t);for(o={},r=0,s=S(Object.keys(n)),i=s.next();!i.done;i=s.next())l=i.value,f=n[l],typeof f!="string"&&f.type==="texture"&&t[f.stream]!==void 0&&++r;1<r&&(e.M=!1),v=S(Object.keys(n)),i=v.next();case 2:if(i.done){q.h=4;break}if(T=i.value,O=n[T],typeof O=="string")return Y=o,te=T,z(q,ar(e,T,t[O]),14);if(j=t[O.stream],O.type==="detection_list"){if(j){for(var de=j.getRectList(),Te=j.getLandmarksList(),we=j.getClassificationsList(),K=[],pe=0;pe<de.size();++pe){var Fe=Jo(de.get(pe)),cr=Ce(Fe,1),ur=Ce(Fe,2),fr=Ce(Fe,3),hr=Ce(Fe,4),dr=Ce(Fe,5,0),St=void 0;St=St===void 0?0:St,Fe={la:{ra:cr,sa:ur,height:fr,width:hr,rotation:dr,pa:xt(He(Fe,6),St)},ea:gt($n(Te.get(pe)),Qe,1).map(Zn),ba:Jn(Wn(we.get(pe)))},K.push(Fe)}de=K}else de=[];o[T]=de,q.h=7;break}if(O.type==="proto_list"){if(j){for(de=Array(j.size()),Te=0;Te<j.size();Te++)de[Te]=j.get(Te);j.delete()}else de=[];o[T]=de,q.h=7;break}if(j===void 0){q.h=3;break}if(O.type==="float_list"){o[T]=j,q.h=7;break}if(O.type==="proto"){o[T]=j,q.h=7;break}if(O.type!=="texture")throw Error("Unknown output config type: '"+O.type+"'");return b=e.v[T],b||(b=new Qt(e.i,e.K),e.v[T]=b),z(q,qn(b,j,e.M),13);case 13:_=q.i,o[T]=_;case 7:O.transform&&o[T]&&(o[T]=O.transform(o[T])),q.h=3;break;case 14:Y[te]=q.i;case 3:i=v.next(),q.h=2;break;case 4:return q.return(o)}})}function ar(e,t,n){var o;return y(function(r){return typeof n=="number"||n instanceof Uint8Array||n instanceof e.i.Uint8BlobList?r.return(n):n instanceof e.i.Texture2dDataOut?(o=e.v[t],o||(o=new Qt(e.i,e.K),e.v[t]=o),r.return(qn(o,n,e.M))):r.return(void 0)})}function lr(e,t){for(var n=t.name||"$",o=[].concat(F(t.wants)),r=new e.i.StringList,s=S(t.wants),i=s.next();!i.done;i=s.next())r.push_back(i.value);s=e.i.PacketListener.implement({onResults:function(l){for(var f={},v=0;v<t.wants.length;++v)f[o[v]]=l.get(v);var T=e.listeners[n];T&&(e.I=sr(e,f,t.outs).then(function(O){O=T(O);for(var j=0;j<t.wants.length;++j){var b=f[o[j]];typeof b=="object"&&b.hasOwnProperty&&b.hasOwnProperty("delete")&&b.delete()}O&&(e.I=O)}))}}),e.j.attachMultiListener(r,s),r.delete()}c.onResults=function(e,t){this.listeners[t||"$"]=e},ee("Solution",qt),ee("OptionType",{BOOL:0,NUMBER:1,ta:2,0:"BOOL",1:"NUMBER",2:"STRING"});function to(e){return e===void 0&&(e=0),e===1?"hand_landmark_full.tflite":"hand_landmark_lite.tflite"}function no(e){var t=this;e=e||{},this.h=new qt({locateFile:e.locateFile,files:function(n){return[{url:"hands_solution_packed_assets_loader.js"},{simd:!1,url:"hands_solution_wasm_bin.js"},{simd:!0,url:"hands_solution_simd_wasm_bin.js"},{data:!0,url:to(n.modelComplexity)}]},graph:{url:"hands.binarypb"},inputs:{image:{type:"video",stream:"input_frames_gpu"}},listeners:[{wants:["multi_hand_landmarks","multi_hand_world_landmarks","image_transformed","multi_handedness"],outs:{image:"image_transformed",multiHandLandmarks:{type:"proto_list",stream:"multi_hand_landmarks",transform:Qn},multiHandWorldLandmarks:{type:"proto_list",stream:"multi_hand_world_landmarks",transform:Qn},multiHandedness:{type:"proto_list",stream:"multi_handedness",transform:function(n){return n.map(function(o){return Jn(Wn(o))[0]})}}}}],options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumHands:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculator",fieldName:"int_value"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(n){var o,r,s;return y(function(i){return i.h==1?(o=to(n),r="third_party/mediapipe/modules/hand_landmark/"+o,z(i,bt(t.h,o),2)):(s=i.i,t.h.overrideFile(r,s),i.return(!0))})}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"handlandmarktrackinggpu__palmdetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"handlandmarktrackinggpu__handlandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}}}})}c=no.prototype,c.close=function(){return this.h.close(),Promise.resolve()},c.onResults=function(e){this.h.onResults(e)},c.initialize=function(){var e=this;return y(function(t){return z(t,e.h.initialize(),0)})},c.reset=function(){this.h.reset()},c.send=function(e){var t=this;return y(function(n){return z(n,t.h.send(e),0)})},c.setOptions=function(e){this.h.setOptions(e)},ee("Hands",no),ee("HAND_CONNECTIONS",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]]),ee("VERSION","0.4.1675469240")}).call(en)),en}var Eo=yr(),tn={},ro;function mr(){return ro||(ro=1,(function(){function c(h){var y=0;return function(){return y<h.length?{done:!1,value:h[y++]}:{done:!0}}}var a=typeof Object.defineProperties=="function"?Object.defineProperty:function(h,y,I){return h==Array.prototype||h==Object.prototype||(h[y]=I.value),h};function d(h){h=[typeof globalThis=="object"&&globalThis,h,typeof window=="object"&&window,typeof self=="object"&&self,typeof ot=="object"&&ot];for(var y=0;y<h.length;++y){var I=h[y];if(I&&I.Math==Math)return I}throw Error("Cannot find global object")}var w=d(this);function x(h,y){if(y)e:{var I=w;h=h.split(".");for(var C=0;C<h.length-1;C++){var X=h[C];if(!(X in I))break e;I=I[X]}h=h[h.length-1],C=I[h],y=y(C),y!=C&&y!=null&&a(I,h,{configurable:!0,writable:!0,value:y})}}x("Symbol",function(h){function y(ee){if(this instanceof y)throw new TypeError("Symbol is not a constructor");return new I(C+(ee||"")+"_"+X++,ee)}function I(ee,g){this.g=ee,a(this,"description",{configurable:!0,writable:!0,value:g})}if(h)return h;I.prototype.toString=function(){return this.g};var C="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",X=0;return y}),x("Symbol.iterator",function(h){if(h)return h;h=Symbol("Symbol.iterator");for(var y="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),I=0;I<y.length;I++){var C=w[y[I]];typeof C=="function"&&typeof C.prototype[h]!="function"&&a(C.prototype,h,{configurable:!0,writable:!0,value:function(){return M(c(this))}})}return h});function M(h){return h={next:h},h[Symbol.iterator]=function(){return this},h}function B(h){var y=typeof Symbol<"u"&&Symbol.iterator&&h[Symbol.iterator];return y?y.call(h):{next:c(h)}}function S(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function F(h){if(h.i)throw new TypeError("Generator is already running");h.i=!0}S.prototype.l=function(h){this.o=h};function U(h,y){h.h={F:y,G:!0},h.j=h.m}S.prototype.return=function(h){this.h={return:h},this.j=this.m};function Q(h){this.g=new S,this.h=h}function ie(h,y){F(h.g);var I=h.g.g;return I?J(h,"return"in I?I.return:function(C){return{value:C,done:!0}},y,h.g.return):(h.g.return(y),ce(h))}function J(h,y,I,C){try{var X=y.call(h.g.g,I);if(!(X instanceof Object))throw new TypeError("Iterator result "+X+" is not an object");if(!X.done)return h.g.i=!1,X;var ee=X.value}catch(g){return h.g.g=null,U(h.g,g),ce(h)}return h.g.g=null,C.call(h.g,ee),ce(h)}function ce(h){for(;h.g.j;)try{var y=h.h(h.g);if(y)return h.g.i=!1,{value:y.value,done:!1}}catch(I){h.g.o=void 0,U(h.g,I)}if(h.g.i=!1,h.g.h){if(y=h.g.h,h.g.h=null,y.G)throw y.F;return{value:y.return,done:!0}}return{value:void 0,done:!0}}function E(h){this.next=function(y){return F(h.g),h.g.g?y=J(h,h.g.g.next,y,h.g.l):(h.g.l(y),y=ce(h)),y},this.throw=function(y){return F(h.g),h.g.g?y=J(h,h.g.g.throw,y,h.g.l):(U(h.g,y),y=ce(h)),y},this.return=function(y){return ie(h,y)},this[Symbol.iterator]=function(){return this}}function k(h){function y(C){return h.next(C)}function I(C){return h.throw(C)}return new Promise(function(C,X){function ee(g){g.done?C(g.value):Promise.resolve(g.value).then(y,I).then(ee,X)}ee(h.next())})}x("Promise",function(h){function y(g){this.h=0,this.i=void 0,this.g=[],this.o=!1;var L=this.j();try{g(L.resolve,L.reject)}catch(V){L.reject(V)}}function I(){this.g=null}function C(g){return g instanceof y?g:new y(function(L){L(g)})}if(h)return h;I.prototype.h=function(g){if(this.g==null){this.g=[];var L=this;this.i(function(){L.l()})}this.g.push(g)};var X=w.setTimeout;I.prototype.i=function(g){X(g,0)},I.prototype.l=function(){for(;this.g&&this.g.length;){var g=this.g;this.g=[];for(var L=0;L<g.length;++L){var V=g[L];g[L]=null;try{V()}catch(Z){this.j(Z)}}}this.g=null},I.prototype.j=function(g){this.i(function(){throw g})},y.prototype.j=function(){function g(Z){return function(ue){V||(V=!0,Z.call(L,ue))}}var L=this,V=!1;return{resolve:g(this.A),reject:g(this.l)}},y.prototype.A=function(g){if(g===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof y)this.C(g);else{e:switch(typeof g){case"object":var L=g!=null;break e;case"function":L=!0;break e;default:L=!1}L?this.v(g):this.m(g)}},y.prototype.v=function(g){var L=void 0;try{L=g.then}catch(V){this.l(V);return}typeof L=="function"?this.D(L,g):this.m(g)},y.prototype.l=function(g){this.u(2,g)},y.prototype.m=function(g){this.u(1,g)},y.prototype.u=function(g,L){if(this.h!=0)throw Error("Cannot settle("+g+", "+L+"): Promise already settled in state"+this.h);this.h=g,this.i=L,this.h===2&&this.B(),this.H()},y.prototype.B=function(){var g=this;X(function(){if(g.I()){var L=w.console;typeof L<"u"&&L.error(g.i)}},1)},y.prototype.I=function(){if(this.o)return!1;var g=w.CustomEvent,L=w.Event,V=w.dispatchEvent;return typeof V>"u"?!0:(typeof g=="function"?g=new g("unhandledrejection",{cancelable:!0}):typeof L=="function"?g=new L("unhandledrejection",{cancelable:!0}):(g=w.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g)),g.promise=this,g.reason=this.i,V(g))},y.prototype.H=function(){if(this.g!=null){for(var g=0;g<this.g.length;++g)ee.h(this.g[g]);this.g=null}};var ee=new I;return y.prototype.C=function(g){var L=this.j();g.s(L.resolve,L.reject)},y.prototype.D=function(g,L){var V=this.j();try{g.call(L,V.resolve,V.reject)}catch(Z){V.reject(Z)}},y.prototype.then=function(g,L){function V(fe,he){return typeof fe=="function"?function(xe){try{Z(fe(xe))}catch(Me){ue(Me)}}:he}var Z,ue,Re=new y(function(fe,he){Z=fe,ue=he});return this.s(V(g,Z),V(L,ue)),Re},y.prototype.catch=function(g){return this.then(void 0,g)},y.prototype.s=function(g,L){function V(){switch(Z.h){case 1:g(Z.i);break;case 2:L(Z.i);break;default:throw Error("Unexpected state: "+Z.h)}}var Z=this;this.g==null?ee.h(V):this.g.push(V),this.o=!0},y.resolve=C,y.reject=function(g){return new y(function(L,V){V(g)})},y.race=function(g){return new y(function(L,V){for(var Z=B(g),ue=Z.next();!ue.done;ue=Z.next())C(ue.value).s(L,V)})},y.all=function(g){var L=B(g),V=L.next();return V.done?C([]):new y(function(Z,ue){function Re(xe){return function(Me){fe[xe]=Me,he--,he==0&&Z(fe)}}var fe=[],he=0;do fe.push(void 0),he++,C(V.value).s(Re(fe.length-1),ue),V=L.next();while(!V.done)})},y});var R=typeof Object.assign=="function"?Object.assign:function(h,y){for(var I=1;I<arguments.length;I++){var C=arguments[I];if(C)for(var X in C)Object.prototype.hasOwnProperty.call(C,X)&&(h[X]=C[X])}return h};x("Object.assign",function(h){return h||R});var G=this||self,W={facingMode:"user",width:640,height:480};function $(h,y){this.video=h,this.i=0,this.h=Object.assign(Object.assign({},W),y)}$.prototype.stop=function(){var h=this,y,I,C,X;return k(new E(new Q(function(ee){if(h.g){for(y=h.g.getTracks(),I=B(y),C=I.next();!C.done;C=I.next())X=C.value,X.stop();h.g=void 0}ee.j=0})))},$.prototype.start=function(){var h=this,y;return k(new E(new Q(function(I){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),y=h.h,I.return(navigator.mediaDevices.getUserMedia({video:{facingMode:y.facingMode,width:y.width,height:y.height}}).then(function(C){oe(h,C)}).catch(function(C){var X="Failed to acquire camera feed: "+C;throw console.error(X),alert(X),C}))})))};function z(h){window.requestAnimationFrame(function(){ke(h)})}function oe(h,y){h.g=y,h.video.srcObject=y,h.video.onloadedmetadata=function(){h.video.play(),z(h)}}function ke(h){var y=null;h.video.paused||h.video.currentTime===h.i||(h.i=h.video.currentTime,y=h.h.onFrame()),y?y.then(function(){z(h)}):z(h)}var ye=["Camera"],ne=G;ye[0]in ne||typeof ne.execScript>"u"||ne.execScript("var "+ye[0]);for(var me;ye.length&&(me=ye.shift());)ye.length||$===void 0?ne[me]&&ne[me]!==Object.prototype[me]?ne=ne[me]:ne=ne[me]={}:ne[me]=$}).call(tn)),tn}var Er=mr(),nn={},io;function wr(){return io||(io=1,(function(){function c(E){var k=0;return function(){return k<E.length?{done:!1,value:E[k++]}:{done:!0}}}var a=typeof Object.defineProperties=="function"?Object.defineProperty:function(E,k,R){return E==Array.prototype||E==Object.prototype||(E[k]=R.value),E};function d(E){E=[typeof globalThis=="object"&&globalThis,E,typeof window=="object"&&window,typeof self=="object"&&self,typeof ot=="object"&&ot];for(var k=0;k<E.length;++k){var R=E[k];if(R&&R.Math==Math)return R}throw Error("Cannot find global object")}var w=d(this);function x(E,k){if(k)e:{var R=w;E=E.split(".");for(var G=0;G<E.length-1;G++){var W=E[G];if(!(W in R))break e;R=R[W]}E=E[E.length-1],G=R[E],k=k(G),k!=G&&k!=null&&a(R,E,{configurable:!0,writable:!0,value:k})}}function M(E){var k=typeof Symbol<"u"&&Symbol.iterator&&E[Symbol.iterator];return k?k.call(E):{next:c(E)}}var B=typeof Object.assign=="function"?Object.assign:function(E,k){for(var R=1;R<arguments.length;R++){var G=arguments[R];if(G)for(var W in G)Object.prototype.hasOwnProperty.call(G,W)&&(E[W]=G[W])}return E};x("Object.assign",function(E){return E||B}),x("Array.prototype.fill",function(E){return E||function(k,R,G){var W=this.length||0;for(0>R&&(R=Math.max(0,W+R)),(G==null||G>W)&&(G=W),G=Number(G),0>G&&(G=Math.max(0,W+G)),R=Number(R||0);R<G;R++)this[R]=k;return this}});function S(E){return E||Array.prototype.fill}x("Int8Array.prototype.fill",S),x("Uint8Array.prototype.fill",S),x("Uint8ClampedArray.prototype.fill",S),x("Int16Array.prototype.fill",S),x("Uint16Array.prototype.fill",S),x("Int32Array.prototype.fill",S),x("Uint32Array.prototype.fill",S),x("Float32Array.prototype.fill",S),x("Float64Array.prototype.fill",S);var F=this||self;function U(E,k){E=E.split(".");var R=F;E[0]in R||typeof R.execScript>"u"||R.execScript("var "+E[0]);for(var G;E.length&&(G=E.shift());)E.length||k===void 0?R[G]&&R[G]!==Object.prototype[G]?R=R[G]:R=R[G]={}:R[G]=k}var Q={color:"white",lineWidth:4,radius:6,visibilityMin:.5};function ie(E){return E=E||{},Object.assign({},Q,{fillColor:E.color},E)}function J(E,k){return E instanceof Function?E(k):E}function ce(E,k,R){return Math.max(Math.min(k,R),Math.min(Math.max(k,R),E))}U("clamp",ce),U("drawLandmarks",function(E,k,R){if(k){R=ie(R),E.save();var G=E.canvas,W=0;k=M(k);for(var $=k.next();!$.done;$=k.next())if($=$.value,$!==void 0&&($.visibility===void 0||$.visibility>R.visibilityMin)){E.fillStyle=J(R.fillColor,{index:W,from:$}),E.strokeStyle=J(R.color,{index:W,from:$}),E.lineWidth=J(R.lineWidth,{index:W,from:$});var z=new Path2D;z.arc($.x*G.width,$.y*G.height,J(R.radius,{index:W,from:$}),0,2*Math.PI),E.fill(z),E.stroke(z),++W}E.restore()}}),U("drawConnectors",function(E,k,R,G){if(k&&R){G=ie(G),E.save();var W=E.canvas,$=0;R=M(R);for(var z=R.next();!z.done;z=R.next()){var oe=z.value;E.beginPath(),z=k[oe[0]],oe=k[oe[1]],z&&oe&&(z.visibility===void 0||z.visibility>G.visibilityMin)&&(oe.visibility===void 0||oe.visibility>G.visibilityMin)&&(E.strokeStyle=J(G.color,{index:$,from:z,to:oe}),E.lineWidth=J(G.lineWidth,{index:$,from:z,to:oe}),E.moveTo(z.x*W.width,z.y*W.height),E.lineTo(oe.x*W.width,oe.y*W.height)),++$,E.stroke()}E.restore()}}),U("drawRectangle",function(E,k,R){R=ie(R),E.save();var G=E.canvas;E.beginPath(),E.lineWidth=J(R.lineWidth,{}),E.strokeStyle=J(R.color,{}),E.fillStyle=J(R.fillColor,{}),E.translate(k.xCenter*G.width,k.yCenter*G.height),E.rotate(k.rotation*Math.PI/180),E.rect(-k.width/2*G.width,-k.height/2*G.height,k.width*G.width,k.height*G.height),E.translate(-k.xCenter*G.width,-k.yCenter*G.height),E.stroke(),E.fill(),E.restore()}),U("lerp",function(E,k,R,G,W){return ce(G*(1-(E-k)/(R-k))+W*(1-(R-E)/(R-k)),G,W)})}).call(nn)),nn}var so=wr();let kt,ao,$e={x:0,y:0},jt=!1,ht=0;const je={speed:1,invertX:!0,invertY:!1,neutralY:.5,deadzone:.1};function vr(c,a){const d=a.getContext("2d");kt=new Eo.Hands({locateFile:w=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${w}`}),kt.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),kt.onResults(w=>{gr(w,a,d)}),ao=new Er.Camera(c,{onFrame:async()=>{await kt.send({image:c})},width:320,height:240}),ao.start(),Rr()}function gr(c,a,d){if(d.save(),d.clearRect(0,0,a.width,a.height),d.drawImage(c.image,0,0,a.width,a.height),c.multiHandLandmarks){for(const w of c.multiHandLandmarks)so.drawConnectors(d,w,Eo.HAND_CONNECTIONS,{color:"#00FF00",lineWidth:5}),so.drawLandmarks(d,w,{color:"#FF0000",lineWidth:2});if(c.multiHandLandmarks.length>0){const w=c.multiHandLandmarks[0];xr(w)}else $e.x=0,$e.y=0,wo(0,0);c.multiHandLandmarks.length===2?Mr(c.multiHandLandmarks[0],c.multiHandLandmarks[1]):(jt=!1,on(!1))}d.restore()}function xr(c){const a=c[8];let d=(a.x-.5)*2,w=(a.y-je.neutralY)*2;je.invertX&&(d=-d),je.invertY&&(w=-w),Math.abs(d)<je.deadzone&&(d=0),Math.abs(w)<je.deadzone&&(w=0),d=Math.max(-1,Math.min(1,d)),w=Math.max(-1,Math.min(1,w)),$e.x=d*je.speed,$e.y=w*je.speed,wo(d,w),Tr($e.x,$e.y)}function Mr(c,a){const d=c[0],w=a[0];Math.sqrt(Math.pow(d.x-w.x,2)+Math.pow(d.y-w.y,2))<.15?ht++:ht=Math.max(0,ht-1),ht>10?jt=!0:ht===0&&(jt=!1)}function wo(c,a){const d=document.getElementById("joystick-dot");if(d){const x=50+c*35,M=50+a*35;d.style.left=`${x}px`,d.style.top=`${M}px`}}function Tr(c,a){const d=document.getElementById("stat-speed"),w=document.getElementById("stat-angle");if(d){const x=Math.sqrt(c*c+a*a).toFixed(2);d.textContent=x}if(w){let x=Math.atan2(a,c)*(180/Math.PI);w.textContent=x.toFixed(0)}}function on(c){const a=document.getElementById("handshake-notification");a&&(a.style.display=c?"block":"none")}function Rr(){const c=document.getElementById("invert-x"),a=document.getElementById("invert-y"),d=document.getElementById("offset-y");c&&c.addEventListener("change",w=>je.invertX=w.target.checked),a&&a.addEventListener("change",w=>je.invertY=w.target.checked),d&&d.addEventListener("input",w=>je.neutralY=parseFloat(w.target.value))}function Hr(){return $e}function br(){return jt}let ge,ve,qe,A,vo=[],go=[],xo,et={},Mo=0,Gt=0,lo=!1,dt=null,Se=null,rn=0,rt=null,To=!1,tt=null,At=null;const Bt=[];let co=0;const Sr=350;let nt=null,sn=null,uo=null,an=null,fo=null,ho=null,po=null,yo=!1,Pe={name:"Player",outfitColor:"#e74c3c",skinColor:"#ffd5b5",hairColor:"#2c1810",hairStyle:0,outfit:0,accessory:0,hat:0};const mo={wordsLearned:[{polish:"Cze",english:"Hello",pronunciation:"cheshch"},{polish:"Dzikuj",english:"Thank you",pronunciation:"jen-KOO-yeh"},{polish:"Prosz",english:"Please / You're welcome",pronunciation:"PRO-sheh"},{polish:"Tak",english:"Yes",pronunciation:"tahk"},{polish:"Nie",english:"No",pronunciation:"nyeh"},{polish:"Dzie dobry",english:"Good day",pronunciation:"jen DOB-ri"},{polish:"Do widzenia",english:"Goodbye",pronunciation:"do vee-DZEN-ya"},{polish:"Przepraszam",english:"Excuse me / Sorry",pronunciation:"psheh-PRA-shahm"}],attempts:[{word:"Cze",accuracy:92,status:"good"},{word:"Dzikuj",accuracy:78,status:"medium"},{word:"Przepraszam",accuracy:65,status:"medium"},{word:"Prosz",accuracy:88,status:"good"},{word:"Do widzenia",accuracy:45,status:"poor"},{word:"Dzie dobry",accuracy:71,status:"medium"}]},kr=[{name:"Elder Frost",position:{x:15,z:15},appearance:{skinColor:16766389,outfitColor:4886745,outfitSecondary:9136404,outfitStyle:"robe",hairColor:13421772,hairStyle:"bald",hat:"none",accessory:"glasses",hasBeard:!0,pantsColor:2899536},dialogue:[{speaker:"npc",text:"Cze! Welcome to our village, traveler!"},{speaker:"player",text:"Hello! This place is beautiful."},{speaker:"npc",text:"Dzikuj! The winter has been harsh..."},{speaker:"npc",text:"But we manage with good company!"},{speaker:"player",text:"I'd love to learn more about your culture."},{speaker:"npc",text:"Feel free to explore! Do widzenia!"}]},{name:"Farmer Beet",position:{x:-20,z:10},appearance:{skinColor:13010498,outfitColor:3447003,outfitSecondary:2719929,outfitStyle:"overalls",hairColor:2889744,hairStyle:"short",hat:"straw",accessory:"none",hasBeard:!1,pantsColor:3447003},dialogue:[{speaker:"npc",text:"Dzie dobry, stranger!"},{speaker:"player",text:"Good morning! Nice farm you have."},{speaker:"npc",text:"Dzikuj! I grow the best turnips!"},{speaker:"npc",text:"Even in winter, my greenhouse works."},{speaker:"player",text:"That's impressive dedication!"},{speaker:"npc",text:"Prosz, stop by for vegetables anytime!"}]},{name:"Blacksmith Ember",position:{x:25,z:-15},appearance:{skinColor:9262372,outfitColor:4861984,outfitSecondary:9136404,outfitStyle:"apron",hairColor:1710618,hairStyle:"mohawk",hat:"none",accessory:"goggles",hasBeard:!0,pantsColor:2889744},dialogue:[{speaker:"npc",text:"*clang clang* Cze! A visitor!"},{speaker:"player",text:"Hello! What are you working on?"},{speaker:"npc",text:"I forge the finest tools here."},{speaker:"player",text:"Your craftsmanship looks amazing."},{speaker:"npc",text:"Dzikuj! Let me know if you need anything crafted!"}]},{name:"Merchant Luna",position:{x:-15,z:-20},appearance:{skinColor:16105626,outfitColor:10181046,outfitSecondary:9323693,outfitStyle:"dress",hairColor:15277667,hairStyle:"long",hat:"beret",accessory:"earrings",hasBeard:!1,pantsColor:10181046},dialogue:[{speaker:"npc",text:"Dzie dobry, dear customer~"},{speaker:"player",text:"What do you sell here?"},{speaker:"npc",text:"I have wares from across the land!"},{speaker:"npc",text:"Prosz, take a look around~"},{speaker:"player",text:"I'll definitely browse your collection."},{speaker:"npc",text:"Dzikuj! Do widzenia!"}]},{name:"Guard Rex",position:{x:0,z:30},appearance:{skinColor:16766389,outfitColor:2899536,outfitSecondary:15844367,outfitStyle:"uniform",hairColor:2889744,hairStyle:"buzz",hat:"police",accessory:"badge",hasBeard:!1,pantsColor:2899536},dialogue:[{speaker:"npc",text:"Halt! State your business!"},{speaker:"player",text:"I'm just exploring the village..."},{speaker:"npc",text:"...Just kidding! Cze!"},{speaker:"npc",text:"I'm Rex, head of the guard."},{speaker:"player",text:"Is it safe around here?"},{speaker:"npc",text:"Tak! Very peaceful. Stay vigilant though!"}]},{name:"Chef Pierre",position:{x:35,z:5},appearance:{skinColor:16766389,outfitColor:16777215,outfitSecondary:15844367,outfitStyle:"chef",hairColor:2889744,hairStyle:"curly",hat:"chef",accessory:"mustache",hasBeard:!1,pantsColor:1710638},dialogue:[{speaker:"npc",text:"Bon appetit! I mean... Cze!"},{speaker:"player",text:"Something smells delicious!"},{speaker:"npc",text:"Dzikuj! I'm preparing pierogi today!"},{speaker:"npc",text:"Polish cuisine is magnifique!"},{speaker:"player",text:"I'd love to try some!"},{speaker:"npc",text:"Prosz, visit me after cooking!"}]},{name:"Builder Kaz",position:{x:-30,z:-30},appearance:{skinColor:13010498,outfitColor:15965202,outfitSecondary:13421772,outfitStyle:"vest",hairColor:1710618,hairStyle:"flat",hat:"hardhat",accessory:"none",hasBeard:!0,pantsColor:3426654},dialogue:[{speaker:"npc",text:"Cze! Watch your step here!"},{speaker:"player",text:"What are you building?"},{speaker:"npc",text:"A new community center!"},{speaker:"npc",text:"Everyone in the village helps out."},{speaker:"player",text:"That's wonderful teamwork!"},{speaker:"npc",text:"Tak! Do widzenia, stay safe!"}]},{name:"Artist Mila",position:{x:-40,z:25},appearance:{skinColor:16105626,outfitColor:1752220,outfitSecondary:1482885,outfitStyle:"smock",hairColor:10181046,hairStyle:"pigtails",hat:"none",accessory:"paintbrush",hasBeard:!1,pantsColor:9323693},dialogue:[{speaker:"npc",text:"Dzie dobry, fellow creative!"},{speaker:"player",text:"Your paintings are beautiful!"},{speaker:"npc",text:"Dzikuj! Art captures the soul!"},{speaker:"npc",text:"Would you like to see my gallery?"},{speaker:"player",text:"I'd love that!"},{speaker:"npc",text:"Prosz, follow me sometime!"}]},{name:"Sailor Jack",position:{x:45,z:25},appearance:{skinColor:14395770,outfitColor:1981023,outfitSecondary:16777215,outfitStyle:"striped",hairColor:16113744,hairStyle:"short",hat:"cap",accessory:"none",hasBeard:!0,pantsColor:1710638},dialogue:[{speaker:"npc",text:"Ahoy there! Cze, landluber!"},{speaker:"player",text:"A sailor? In a winter village?"},{speaker:"npc",text:"Ha! The lake freezes, but sailors never rest!"},{speaker:"npc",text:"Dzikuj for the company!"},{speaker:"player",text:"Any stories from the waters?"},{speaker:"npc",text:"Many! Come visit my boat sometime. Do widzenia!"}]},{name:"Nurse Rosa",position:{x:-50,z:-10},appearance:{skinColor:16772306,outfitColor:16738740,outfitSecondary:16777215,outfitStyle:"scrubs",hairColor:16739179,hairStyle:"ponytail",hat:"none",accessory:"glasses",hasBeard:!1,pantsColor:16738740},dialogue:[{speaker:"npc",text:"Dzie dobry! Are you feeling well?"},{speaker:"player",text:"I'm fine, just exploring!"},{speaker:"npc",text:"That's wonderful! Stay warm out there."},{speaker:"npc",text:"The cold can be harsh on newcomers."},{speaker:"player",text:"Any health tips?"},{speaker:"npc",text:"Drink warm tea! Prosz, visit if you need anything!"}]},{name:"Scholar Tym",position:{x:50,z:-30},appearance:{skinColor:10840890,outfitColor:4854924,outfitSecondary:9136404,outfitStyle:"robe",hairColor:2600544,hairStyle:"wavy",hat:"wizard",accessory:"round_glasses",hasBeard:!1,pantsColor:2889744},dialogue:[{speaker:"npc",text:"Cze, curious traveler!"},{speaker:"player",text:"Are you a wizard?"},{speaker:"npc",text:"A scholar! Though some call me... mysterious."},{speaker:"npc",text:"Dzikuj for visiting the library!"},{speaker:"player",text:"What do you study?"},{speaker:"npc",text:"Languages! Polish is fascinating. Do widzenia!"}]},{name:"Thief Marcus",position:{x:-55,z:40},appearance:{skinColor:6044974,outfitColor:1710618,outfitSecondary:2899536,outfitStyle:"cloak",hairColor:1710618,hairStyle:"slickback",hat:"hood",accessory:"eyepatch",hasBeard:!0,pantsColor:1710638},dialogue:[{speaker:"npc",text:"Psst... Cze, stranger."},{speaker:"player",text:"Who are you?"},{speaker:"npc",text:"Just a... traveling merchant. Tak, that's it."},{speaker:"npc",text:"I have rare items, if you're interested."},{speaker:"player",text:"Sounds suspicious..."},{speaker:"npc",text:"Nie, nie! Everything is legitimate! Do widzenia!"}]},{name:"Dancer Zofia",position:{x:20,z:45},appearance:{skinColor:16105626,outfitColor:15158332,outfitSecondary:15844367,outfitStyle:"dress",hairColor:2889744,hairStyle:"curly",hat:"flower",accessory:"earrings",hasBeard:!1,pantsColor:15158332},dialogue:[{speaker:"npc",text:"Dzie dobry! Care to dance?"},{speaker:"player",text:"I don't know how to dance..."},{speaker:"npc",text:"That's okay! Feel the music in your heart!"},{speaker:"npc",text:"Polish folk dances are beautiful!"},{speaker:"player",text:"Maybe you could teach me sometime?"},{speaker:"npc",text:"Tak! Dzikuj for your enthusiasm! Do widzenia!"}]},{name:"Miner Gus",position:{x:-25,z:55},appearance:{skinColor:9262372,outfitColor:5597999,outfitSecondary:9127187,outfitStyle:"overalls",hairColor:9127187,hairStyle:"buzz",hat:"hardhat",accessory:"goggles",hasBeard:!0,pantsColor:5597999},dialogue:[{speaker:"npc",text:"Cze! Fresh from the mines!"},{speaker:"player",text:"What do you mine here?"},{speaker:"npc",text:"Precious gems and coal!"},{speaker:"npc",text:"Dzikuj for asking! Most folks avoid us miners."},{speaker:"player",text:"It sounds like hard work."},{speaker:"npc",text:"Tak, but rewarding! Do widzenia, friend!"}]}];window.addEventListener("load",Gr);function Gr(){const c=localStorage.getItem("playerCharacter");c&&(Pe=JSON.parse(c)),document.getElementById("playerName").textContent=Pe.name||"Player",Ar(),Lr(),zr(),Ir(),Or(),_r(),Dr(),Ur(),Vr(),Yr(),ti(),jr();const a=document.querySelector(".input_video"),d=document.querySelector(".output_canvas");a&&d&&vr(a,d),Pr(),xo=new THREE.Clock,Ho()}function Ar(){["sounds/footstep_snow_1.mp3","sounds/footstep_snow_2.mp3","sounds/footstep_snow_3.mp3","sounds/footstep_snow_4.mp3"].forEach(a=>{const d=new Audio(a);d.volume=.4,Bt.push(d)}),nt=new Audio("sounds/ambient_wind.mp3"),nt.loop=!0,nt.volume=.3,sn=new Audio("sounds/dialogue_open.mp3"),sn.volume=.5,uo=new Audio("sounds/dialogue_advance.mp3"),uo.volume=.4,an=new Audio("sounds/interact_prompt.mp3"),an.volume=.3,fo=new Audio("sounds/cat_meow.mp3"),fo.volume=.6,ho=new Audio("sounds/bird_chirp.mp3"),ho.volume=.5,po=new Audio("sounds/quest_complete.mp3"),po.volume=.6}function Ro(c){if(c){const a=c.cloneNode();a.volume=c.volume,a.play().catch(()=>{})}}function Br(){nt&&nt.paused&&nt.play().catch(()=>{})}function Cr(){const c=Date.now();if(c-co<Sr||(co=c,Bt.length===0))return;const d=Bt[Math.floor(Math.random()*Bt.length)].cloneNode();d.volume=.3+Math.random()*.2,d.playbackRate=.9+Math.random()*.2,d.play().catch(()=>{})}function jr(){const c=document.getElementById("journalBtn"),a=document.getElementById("journalBtnChat"),d=document.getElementById("journalModal"),w=document.getElementById("journalClose");c.addEventListener("click",()=>{ln(),d.classList.add("active")}),a.addEventListener("click",()=>{ln(),d.classList.add("active")}),w.addEventListener("click",()=>{d.classList.remove("active")}),d.addEventListener("click",x=>{x.target===d&&d.classList.remove("active")})}function ln(){const c=document.getElementById("wordList");c.innerHTML=mo.wordsLearned.map(d=>`
        <div class="word-item">
            <div class="word-polish">${d.polish}</div>
            <div class="word-english">${d.english}</div>
            <div class="word-pronunciation">/${d.pronunciation}/</div>
        </div>
    `).join("");const a=document.getElementById("attemptList");a.innerHTML=mo.attempts.map(d=>`
        <div class="attempt-item">
            <span class="attempt-word">${d.word}</span>
            <span class="attempt-accuracy ${d.status}">${d.accuracy}%</span>
        </div>
    `).join("")}function Pr(){const c=document.getElementById("loadingBar");let a=0;const d=setInterval(()=>{a+=Math.random()*15,a>=100&&(a=100,clearInterval(d),setTimeout(()=>{document.getElementById("loadingScreen").classList.add("hidden")},500)),c.style.width=a+"%"},200)}function Lr(){ge=new THREE.Scene,ge.background=new THREE.Color(8900331),ge.fog=new THREE.Fog(13166840,50,150),ve=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),ve.position.set(0,5,10),qe=new THREE.WebGLRenderer({canvas:document.getElementById("gameCanvas"),antialias:!0}),qe.setSize(window.innerWidth,window.innerHeight),qe.shadowMap.enabled=!0,qe.shadowMap.type=THREE.PCFSoftShadowMap,window.addEventListener("resize",()=>{ve.aspect=window.innerWidth/window.innerHeight,ve.updateProjectionMatrix(),qe.setSize(window.innerWidth,window.innerHeight)})}function zr(){const c=new THREE.AmbientLight(11584734,.6);ge.add(c);const a=new THREE.DirectionalLight(16777215,.8);a.position.set(50,100,50),a.castShadow=!0,a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048,a.shadow.camera.near=.5,a.shadow.camera.far=500,a.shadow.camera.left=-100,a.shadow.camera.right=100,a.shadow.camera.top=100,a.shadow.camera.bottom=-100,ge.add(a);const d=new THREE.HemisphereLight(8900331,10017165,.4);ge.add(d)}function Ir(){const c=new THREE.PlaneGeometry(200,200,50,50),a=new THREE.MeshStandardMaterial({color:16777215,roughness:.8,metalness:.1}),d=c.attributes.position;for(let x=0;x<d.count;x++)d.setZ(x,Math.random()*.5);c.computeVertexNormals();const w=new THREE.Mesh(c,a);w.rotation.x=-Math.PI/2,w.receiveShadow=!0,ge.add(w);for(let x=0;x<30;x++){const M=new THREE.CircleGeometry(1+Math.random()*2,8),B=new THREE.MeshStandardMaterial({color:5933658}),S=new THREE.Mesh(M,B);S.rotation.x=-Math.PI/2,S.position.set((Math.random()-.5)*150,.01,(Math.random()-.5)*150),ge.add(S)}}function Or(){A=new THREE.Group;const c=parseInt(Pe.outfitColor.replace("#","0x")),a=parseInt(Pe.skinColor.replace("#","0x")),d=parseInt(Pe.hairColor.replace("#","0x")),w=["Spiky","Mohawk","Flat Top","Long","Short","Ponytail","Bald","Curly","Afro","Pigtails","Buzz Cut","Side Part"],x=["None","Cap","Beanie","Top Hat","Cowboy","Hard Hat","Crown","Headphones","Police Cap","Beret"],M=["None","Glasses","Sunglasses","Round Glasses","Eye Patch","Monocle","Bandana","Scarf"],B=w[Pe.hairStyle]||"Spiky",S=x[Pe.hat]||"None",F=M[Pe.accessory]||"None",U=new THREE.BoxGeometry(.5,1,.5),Q=new THREE.MeshStandardMaterial({color:3816026}),ie=new THREE.Mesh(U,Q);ie.position.set(-.35,.5,0),ie.castShadow=!0,A.add(ie);const J=new THREE.Mesh(U,Q);J.position.set(.35,.5,0),J.castShadow=!0,A.add(J);const ce=new THREE.BoxGeometry(.55,.25,.6),E=new THREE.MeshStandardMaterial({color:4861984}),k=new THREE.Mesh(ce,E);k.position.set(-.35,.12,.05),A.add(k);const R=new THREE.Mesh(ce,E);R.position.set(.35,.12,.05),A.add(R);const G=new THREE.BoxGeometry(1.5,2,1),W=new THREE.MeshStandardMaterial({color:c}),$=new THREE.Mesh(G,W);$.position.y=2,$.castShadow=!0,A.add($);const z=new THREE.BoxGeometry(.4,1.5,.4),oe=new THREE.MeshStandardMaterial({color:a}),ke=new THREE.Mesh(z,oe);ke.position.set(-.95,2.2,0),ke.castShadow=!0,A.add(ke);const ye=new THREE.Mesh(z,oe);ye.position.set(.95,2.2,0),ye.castShadow=!0,A.add(ye);const ne=new THREE.BoxGeometry(.35,.35,.35),me=new THREE.MeshStandardMaterial({color:a}),h=new THREE.Mesh(ne,me);h.position.set(-.95,1.3,0),A.add(h);const y=new THREE.Mesh(ne,me);y.position.set(.95,1.3,0),A.add(y);const I=new THREE.BoxGeometry(1,1,1),C=new THREE.MeshStandardMaterial({color:a}),X=new THREE.Mesh(I,C);X.position.y=3.5,X.castShadow=!0,A.add(X);const ee=new THREE.BoxGeometry(.18,.18,.1),g=new THREE.MeshStandardMaterial({color:2894892}),L=new THREE.Mesh(ee,g);L.position.set(-.25,3.55,.5),A.add(L);const V=new THREE.Mesh(ee,g);V.position.set(.25,3.55,.5),A.add(V);const Z=new THREE.BoxGeometry(.06,.06,.05),ue=new THREE.MeshStandardMaterial({color:16777215,emissive:16777215,emissiveIntensity:.5}),Re=new THREE.Mesh(Z,ue);Re.position.set(-.22,3.58,.55),A.add(Re);const fe=new THREE.Mesh(Z,ue);fe.position.set(.28,3.58,.55),A.add(fe);const he=new THREE.BoxGeometry(.22,.06,.1),xe=new THREE.MeshStandardMaterial({color:d}),Me=new THREE.Mesh(he,xe);Me.position.set(-.25,3.72,.5),A.add(Me);const Oe=new THREE.Mesh(he,xe);Oe.position.set(.25,3.72,.5),A.add(Oe);const Ke=new THREE.BoxGeometry(.3,.08,.1),De=new THREE.MeshStandardMaterial({color:9127187}),Ne=new THREE.Mesh(Ke,De);Ne.position.set(0,3.25,.5),A.add(Ne);const se=new THREE.MeshStandardMaterial({color:d});if(B!=="Bald"){if(B==="Spiky"){const D=new THREE.BoxGeometry(.2,.4,.2);[[-.3,4.2,.2],[0,4.3,.2],[.3,4.2,.2],[-.2,4.15,-.2],[.2,4.15,-.2]].forEach(p=>{const u=new THREE.Mesh(D,se);u.position.set(...p),A.add(u)})}else if(B==="Short"||B==="Buzz Cut"){const D=new THREE.BoxGeometry(1.05,.3,1.05),m=new THREE.Mesh(D,se);m.position.set(0,4.1,0),A.add(m)}else if(B==="Mohawk"){const D=new THREE.BoxGeometry(.25,.7,.8),m=new THREE.Mesh(D,se);m.position.set(0,4.3,0),A.add(m)}else if(B==="Long"){const D=new THREE.BoxGeometry(1.1,.3,1.1),m=new THREE.Mesh(D,se);m.position.set(0,4.1,0),A.add(m);const p=new THREE.BoxGeometry(.2,1.2,1.1),u=new THREE.Mesh(p,se);u.position.set(-.55,3.5,0),A.add(u);const H=new THREE.Mesh(p,se);H.position.set(.55,3.5,0),A.add(H)}else if(B==="Curly"||B==="Afro"){const D=B==="Afro"?.5:.35,m=new THREE.BoxGeometry(D,D,D);[[-.3,4.15,.2],[.3,4.15,.2],[0,4.2,.3],[-.35,4.1,-.2],[.35,4.1,-.2],[0,4.15,-.3]].forEach(u=>{const H=new THREE.Mesh(m,se);H.position.set(...u),A.add(H)})}else if(B==="Ponytail"){const D=new THREE.BoxGeometry(1.05,.2,1.05),m=new THREE.Mesh(D,se);m.position.set(0,4.05,0),A.add(m);const p=new THREE.BoxGeometry(.25,.8,.25),u=new THREE.Mesh(p,se);u.position.set(0,3.5,-.5),A.add(u)}else if(B==="Pigtails"){const D=new THREE.BoxGeometry(1.05,.2,1.05),m=new THREE.Mesh(D,se);m.position.set(0,4.05,0),A.add(m);const p=new THREE.BoxGeometry(.25,.8,.25),u=new THREE.Mesh(p,se);u.position.set(-.55,3.5,0),A.add(u);const H=new THREE.Mesh(p,se);H.position.set(.55,3.5,0),A.add(H)}else if(B==="Flat Top"){const D=new THREE.BoxGeometry(1.1,.25,1.1),m=new THREE.Mesh(D,se);m.position.set(0,4.1,0),A.add(m)}else if(B==="Side Part"){const D=new THREE.BoxGeometry(1.1,.35,1.05),m=new THREE.Mesh(D,se);m.position.set(-.1,4.1,0),A.add(m)}}if(S!=="None"){if(S==="Cap"){const D=new THREE.BoxGeometry(1.1,.35,1.1),m=new THREE.MeshStandardMaterial({color:2899536}),p=new THREE.Mesh(D,m);p.position.set(0,4.15,0),A.add(p);const u=new THREE.BoxGeometry(.8,.1,.4),H=new THREE.Mesh(u,m);H.position.set(0,4.05,.6),A.add(H)}else if(S==="Beanie"){const D=new THREE.BoxGeometry(1.1,.5,1.1),m=new THREE.MeshStandardMaterial({color:9323693}),p=new THREE.Mesh(D,m);p.position.set(0,4.2,0),A.add(p)}else if(S==="Crown"){const D=new THREE.BoxGeometry(1.1,.2,1.1),m=new THREE.MeshStandardMaterial({color:15844367,emissive:15844367,emissiveIntensity:.2}),p=new THREE.Mesh(D,m);p.position.set(0,4.1,0),A.add(p);const u=new THREE.BoxGeometry(.15,.3,.15);[[-.35,4.35,0],[0,4.4,0],[.35,4.35,0]].forEach(P=>{const N=new THREE.Mesh(u,m);N.position.set(...P),A.add(N)})}}if(F!=="None"){if(F==="Glasses"||F==="Round Glasses"){const D=new THREE.BoxGeometry(.9,.2,.1),m=new THREE.MeshStandardMaterial({color:3355443}),p=new THREE.Mesh(D,m);p.position.set(0,3.55,.55),A.add(p)}else if(F==="Sunglasses"){const D=new THREE.BoxGeometry(.28,.2,.1),m=new THREE.MeshStandardMaterial({color:1118481}),p=new THREE.Mesh(D,m);p.position.set(-.25,3.55,.55),A.add(p);const u=new THREE.Mesh(D,m);u.position.set(.25,3.55,.55),A.add(u)}else if(F==="Scarf"){const D=new THREE.BoxGeometry(1.6,.3,.3),m=new THREE.MeshStandardMaterial({color:15158332}),p=new THREE.Mesh(D,m);p.position.set(0,2.9,.3),A.add(p)}}A.position.set(0,0,0),ge.add(A)}function _r(){kr.forEach(c=>{const a=Fr(c.appearance);a.position.set(c.position.x,0,c.position.z),a.userData.name=c.name,a.userData.dialogue=c.dialogue,a.userData.appearance=c.appearance,vo.push(a),ge.add(a),c.name})}function Fr(c){const a=new THREE.Group,{skinColor:d,outfitColor:w,outfitSecondary:x,outfitStyle:M,hairColor:B,hairStyle:S,hat:F,accessory:U,hasBeard:Q,pantsColor:ie}=c,J=new THREE.BoxGeometry(.5,1,.5),ce=new THREE.MeshStandardMaterial({color:ie||3816026}),E=new THREE.Mesh(J,ce);E.position.set(-.35,.5,0),E.castShadow=!0,a.add(E);const k=new THREE.Mesh(J,ce);k.position.set(.35,.5,0),k.castShadow=!0,a.add(k);const R=new THREE.BoxGeometry(.55,.25,.6),G=new THREE.MeshStandardMaterial({color:4861984}),W=new THREE.Mesh(R,G);W.position.set(-.35,.12,.05),a.add(W);const $=new THREE.Mesh(R,G);$.position.set(.35,.12,.05),a.add($);let z=1.5,oe=2;if(M==="dress"){const m=new THREE.BoxGeometry(1.8,2.2,1),p=new THREE.MeshStandardMaterial({color:w}),u=new THREE.Mesh(m,p);u.position.y=2,u.castShadow=!0,a.add(u);const H=new THREE.BoxGeometry(1.85,.15,1.05),P=new THREE.MeshStandardMaterial({color:x||15844367}),N=new THREE.Mesh(H,P);N.position.y=1,a.add(N)}else if(M==="striped"){const m=new THREE.BoxGeometry(z,oe,1),p=new THREE.MeshStandardMaterial({color:w}),u=new THREE.Mesh(m,p);u.position.y=2,u.castShadow=!0,a.add(u);const H=x||16777215;for(let P=0;P<4;P++){const N=new THREE.BoxGeometry(z+.02,.25,1.02),ae=new THREE.MeshStandardMaterial({color:H}),le=new THREE.Mesh(N,ae);le.position.y=1.3+P*.5,a.add(le)}}else if(M==="cloak"){const m=new THREE.BoxGeometry(1.8,2.3,1.2),p=new THREE.MeshStandardMaterial({color:w}),u=new THREE.Mesh(m,p);u.position.y=2,u.castShadow=!0,a.add(u)}else if(M==="scrubs"){const m=new THREE.BoxGeometry(z,oe,1),p=new THREE.MeshStandardMaterial({color:w}),u=new THREE.Mesh(m,p);u.position.y=2,u.castShadow=!0,a.add(u);const H=new THREE.BoxGeometry(.4,.3,.1),P=new THREE.MeshStandardMaterial({color:d}),N=new THREE.Mesh(H,P);N.position.set(0,2.85,.5),a.add(N)}else{const m=new THREE.BoxGeometry(z,oe,1),p=new THREE.MeshStandardMaterial({color:w}),u=new THREE.Mesh(m,p);u.position.y=2,u.castShadow=!0,a.add(u)}if(M==="overalls"){const m=new THREE.BoxGeometry(.15,.8,.1),p=new THREE.MeshStandardMaterial({color:w}),u=new THREE.Mesh(m,p);u.position.set(-.4,2.8,.5),a.add(u);const H=new THREE.Mesh(m,p);H.position.set(.4,2.8,.5),a.add(H)}else if(M==="uniform"||M==="chef"){const m=new THREE.BoxGeometry(.12,.12,.1),p=new THREE.MeshStandardMaterial({color:15844367});for(let u=0;u<3;u++){const H=new THREE.Mesh(m,p);H.position.set(0,2.6-u*.4,.55),a.add(H)}}else if(M==="apron"){const m=new THREE.BoxGeometry(1.2,1.5,.15),p=new THREE.MeshStandardMaterial({color:9136404}),u=new THREE.Mesh(m,p);u.position.set(0,1.8,.55),a.add(u)}else if(M==="vest"){const m=new THREE.BoxGeometry(.1,1.5,.1),p=new THREE.MeshStandardMaterial({color:13421772,emissive:4473924}),u=new THREE.Mesh(m,p);u.position.set(-.5,2.2,.55),a.add(u);const H=new THREE.Mesh(m,p);H.position.set(.5,2.2,.55),a.add(H)}else if(M==="robe"){const m=new THREE.BoxGeometry(1.6,.3,.3),p=new THREE.MeshStandardMaterial({color:x||9136404}),u=new THREE.Mesh(m,p);u.position.set(0,2.85,.3),a.add(u)}else if(M==="smock"){const m=new THREE.BoxGeometry(1.6,2.1,1),p=new THREE.MeshStandardMaterial({color:w}),u=new THREE.Mesh(m,p);u.position.y=2,u.castShadow=!0,a.add(u);const H=[15158332,15844367,3447003,10181046];[[-.4,2.3,.52],[.3,1.8,.52],[-.2,1.5,.52],[.4,2.5,.52]].forEach((N,ae)=>{const le=new THREE.BoxGeometry(.2,.2,.05),ze=new THREE.MeshStandardMaterial({color:H[ae]}),_e=new THREE.Mesh(le,ze);_e.position.set(...N),a.add(_e)})}const ke=new THREE.BoxGeometry(.4,1.5,.4),ye=new THREE.MeshStandardMaterial({color:d}),ne=new THREE.Mesh(ke,ye);ne.position.set(-.95,2.2,0),ne.castShadow=!0,a.add(ne);const me=new THREE.Mesh(ke,ye);me.position.set(.95,2.2,0),me.castShadow=!0,a.add(me);const h=new THREE.BoxGeometry(.35,.35,.35),y=new THREE.MeshStandardMaterial({color:d}),I=new THREE.Mesh(h,y);I.position.set(-.95,1.3,0),a.add(I);const C=new THREE.Mesh(h,y);C.position.set(.95,1.3,0),a.add(C);const X=new THREE.BoxGeometry(1,1,1),ee=new THREE.MeshStandardMaterial({color:d}),g=new THREE.Mesh(X,ee);g.position.y=3.5,g.castShadow=!0,a.add(g);const L=new THREE.BoxGeometry(.18,.18,.1),V=new THREE.MeshStandardMaterial({color:2894892}),Z=new THREE.Mesh(L,V);Z.position.set(-.25,3.55,.5),a.add(Z);const ue=new THREE.Mesh(L,V);ue.position.set(.25,3.55,.5),a.add(ue);const Re=new THREE.BoxGeometry(.06,.06,.05),fe=new THREE.MeshStandardMaterial({color:16777215,emissive:16777215,emissiveIntensity:.5}),he=new THREE.Mesh(Re,fe);he.position.set(-.22,3.58,.55),a.add(he);const xe=new THREE.Mesh(Re,fe);xe.position.set(.28,3.58,.55),a.add(xe);const Me=new THREE.BoxGeometry(.22,.06,.1),Oe=new THREE.MeshStandardMaterial({color:B}),Ke=new THREE.Mesh(Me,Oe);Ke.position.set(-.25,3.72,.5),a.add(Ke);const De=new THREE.Mesh(Me,Oe);De.position.set(.25,3.72,.5),a.add(De);const Ne=new THREE.BoxGeometry(.3,.08,.1),se=new THREE.MeshStandardMaterial({color:9127187}),D=new THREE.Mesh(Ne,se);if(D.position.set(0,3.25,.5),a.add(D),Q){const m=new THREE.BoxGeometry(.8,.5,.3),p=new THREE.MeshStandardMaterial({color:B}),u=new THREE.Mesh(m,p);u.position.set(0,3.1,.4),a.add(u)}if(S!=="bald"){const m=new THREE.MeshStandardMaterial({color:B});if(S==="short"||S==="buzz"){const p=new THREE.BoxGeometry(1.05,.3,1.05),u=new THREE.Mesh(p,m);u.position.set(0,4.1,0),a.add(u)}else if(S==="mohawk"){const p=new THREE.BoxGeometry(.25,.7,.8),u=new THREE.Mesh(p,m);u.position.set(0,4.3,0),a.add(u)}else if(S==="long"){const p=new THREE.BoxGeometry(1.1,.3,1.1),u=new THREE.Mesh(p,m);u.position.set(0,4.1,0),a.add(u);const H=new THREE.BoxGeometry(.2,1.2,1.1),P=new THREE.Mesh(H,m);P.position.set(-.55,3.5,0),a.add(P);const N=new THREE.Mesh(H,m);N.position.set(.55,3.5,0),a.add(N);const ae=new THREE.BoxGeometry(1.1,1.5,.2),le=new THREE.Mesh(ae,m);le.position.set(0,3.3,-.55),a.add(le)}else if(S==="curly"){const p=new THREE.BoxGeometry(.35,.35,.35);[[-.3,4.15,.2],[.3,4.15,.2],[0,4.2,.3],[-.35,4.1,-.2],[.35,4.1,-.2],[0,4.15,-.3]].forEach(H=>{const P=new THREE.Mesh(p,m);P.position.set(...H),a.add(P)})}else if(S==="flat"){const p=new THREE.BoxGeometry(1.1,.25,1.1),u=new THREE.Mesh(p,m);u.position.set(0,4.1,0),a.add(u)}else if(S==="pigtails"){const p=new THREE.BoxGeometry(1.05,.2,1.05),u=new THREE.Mesh(p,m);u.position.set(0,4.05,0),a.add(u);const H=new THREE.BoxGeometry(.25,.8,.25),P=new THREE.Mesh(H,m);P.position.set(-.55,3.5,0),a.add(P);const N=new THREE.Mesh(H,m);N.position.set(.55,3.5,0),a.add(N)}else if(S==="wavy"){const p=new THREE.BoxGeometry(1.1,.4,1.1),u=new THREE.Mesh(p,m);u.position.set(0,4.15,0),a.add(u);const H=new THREE.BoxGeometry(.25,.8,.8),P=new THREE.Mesh(H,m);P.position.set(-.55,3.5,0),a.add(P);const N=new THREE.Mesh(H,m);N.position.set(.55,3.5,0),a.add(N)}else if(S==="slickback"){const p=new THREE.BoxGeometry(1.05,.25,1.1),u=new THREE.Mesh(p,m);u.position.set(0,4.08,-.05),a.add(u)}else if(S==="ponytail"){const p=new THREE.BoxGeometry(1.05,.2,1.05),u=new THREE.Mesh(p,m);u.position.set(0,4.05,0),a.add(u);const H=new THREE.BoxGeometry(.25,.9,.25),P=new THREE.Mesh(H,m);P.position.set(0,3.4,-.5),a.add(P)}}if(F!=="none"){if(F==="straw"){const m=new THREE.BoxGeometry(1.6,.15,1.6),p=new THREE.MeshStandardMaterial({color:14329120}),u=new THREE.Mesh(m,p);u.position.set(0,4.05,0),a.add(u);const H=new THREE.BoxGeometry(.9,.5,.9),P=new THREE.Mesh(H,p);P.position.set(0,4.3,0),a.add(P)}else if(F==="police"){const m=new THREE.BoxGeometry(1.1,.35,1.1),p=new THREE.MeshStandardMaterial({color:2899536}),u=new THREE.Mesh(m,p);u.position.set(0,4.15,0),a.add(u);const H=new THREE.BoxGeometry(.25,.2,.1),P=new THREE.MeshStandardMaterial({color:15844367,emissive:15844367,emissiveIntensity:.3}),N=new THREE.Mesh(H,P);N.position.set(0,4.2,.55),a.add(N);const ae=new THREE.BoxGeometry(.8,.1,.4),le=new THREE.MeshStandardMaterial({color:1710618}),ze=new THREE.Mesh(ae,le);ze.position.set(0,4.05,.6),a.add(ze)}else if(F==="chef"){const m=new THREE.BoxGeometry(.9,.8,.9),p=new THREE.MeshStandardMaterial({color:16777215}),u=new THREE.Mesh(m,p);u.position.set(0,4.4,0),a.add(u);const H=new THREE.BoxGeometry(1,.4,1),P=new THREE.Mesh(H,p);P.position.set(0,4.9,0),a.add(P)}else if(F==="hardhat"){const m=new THREE.BoxGeometry(1.2,.5,1.2),p=new THREE.MeshStandardMaterial({color:15965202}),u=new THREE.Mesh(m,p);u.position.set(0,4.2,0),a.add(u)}else if(F==="beret"){const m=new THREE.BoxGeometry(1.1,.25,1.1),p=new THREE.MeshStandardMaterial({color:12597547}),u=new THREE.Mesh(m,p);u.position.set(.1,4.1,0),u.rotation.z=.15,a.add(u)}else if(F==="hood"){const m=new THREE.BoxGeometry(1.3,.8,1.3),p=new THREE.MeshStandardMaterial({color:1710618}),u=new THREE.Mesh(m,p);u.position.set(0,4,0),a.add(u);const H=new THREE.BoxGeometry(1.4,.3,.5),P=new THREE.Mesh(H,p);P.position.set(0,4.3,.5),a.add(P)}else if(F==="wizard"){const m=new THREE.BoxGeometry(1.4,.15,1.4),p=new THREE.MeshStandardMaterial({color:4854924}),u=new THREE.Mesh(m,p);u.position.set(0,4.05,0),a.add(u);const H=new THREE.BoxGeometry(.8,1.2,.8),P=new THREE.Mesh(H,p);P.position.set(0,4.7,0),a.add(P);const N=new THREE.BoxGeometry(.15,.15,.1),ae=new THREE.MeshStandardMaterial({color:15844367,emissive:15844367,emissiveIntensity:.3}),le=new THREE.Mesh(N,ae);le.position.set(0,5.2,.4),a.add(le)}else if(F==="flower"){const m=new THREE.BoxGeometry(1.15,.2,1.15),p=new THREE.MeshStandardMaterial({color:3066993}),u=new THREE.Mesh(m,p);u.position.set(0,4.05,0),a.add(u);const H=[15158332,15844367,16738740,10181046];[[-.35,4.2,.3],[.35,4.2,.3],[0,4.25,.4],[-.4,4.15,-.2],[.4,4.15,-.2]].forEach((N,ae)=>{const le=new THREE.BoxGeometry(.2,.2,.15),ze=new THREE.MeshStandardMaterial({color:H[ae%H.length]}),_e=new THREE.Mesh(le,ze);_e.position.set(...N),a.add(_e)})}else if(F==="cap"){const m=new THREE.BoxGeometry(1.1,.35,1.1),p=new THREE.MeshStandardMaterial({color:2899536}),u=new THREE.Mesh(m,p);u.position.set(0,4.15,0),a.add(u);const H=new THREE.BoxGeometry(.8,.1,.4),P=new THREE.Mesh(H,p);P.position.set(0,4.05,.6),a.add(P)}}if(U!=="none"){if(U==="glasses"||U==="goggles"){const m=U==="goggles"?9127187:3355443,p=new THREE.BoxGeometry(.9,.2,.1),u=new THREE.MeshStandardMaterial({color:m}),H=new THREE.Mesh(p,u);H.position.set(0,3.55,.55),a.add(H);const P=new THREE.BoxGeometry(.25,.2,.08),N=new THREE.MeshStandardMaterial({color:U==="goggles"?8965375:16777215,transparent:!0,opacity:.5}),ae=new THREE.Mesh(P,N);ae.position.set(-.25,3.55,.58),a.add(ae);const le=new THREE.Mesh(P,N);le.position.set(.25,3.55,.58),a.add(le)}else if(U==="badge"){const m=new THREE.BoxGeometry(.3,.35,.1),p=new THREE.MeshStandardMaterial({color:15844367,emissive:15844367,emissiveIntensity:.2}),u=new THREE.Mesh(m,p);u.position.set(-.5,2.6,.55),a.add(u)}else if(U==="earrings"){const m=new THREE.BoxGeometry(.1,.2,.1),p=new THREE.MeshStandardMaterial({color:15844367,emissive:15844367,emissiveIntensity:.3}),u=new THREE.Mesh(m,p);u.position.set(-.55,3.35,0),a.add(u);const H=new THREE.Mesh(m,p);H.position.set(.55,3.35,0),a.add(H)}else if(U==="mustache"){const m=new THREE.BoxGeometry(.5,.12,.15),p=new THREE.MeshStandardMaterial({color:2889744}),u=new THREE.Mesh(m,p);u.position.set(0,3.32,.5),a.add(u)}else if(U==="paintbrush"){const m=new THREE.BoxGeometry(.1,.6,.1),p=new THREE.MeshStandardMaterial({color:9127187}),u=new THREE.Mesh(m,p);u.position.set(.95,1.6,.3),u.rotation.x=.5,a.add(u);const H=new THREE.BoxGeometry(.15,.25,.15),P=new THREE.MeshStandardMaterial({color:15158332}),N=new THREE.Mesh(H,P);N.position.set(.95,1.95,.45),a.add(N)}else if(U==="eyepatch"){const m=new THREE.BoxGeometry(.3,.25,.1),p=new THREE.MeshStandardMaterial({color:1710618}),u=new THREE.Mesh(m,p);u.position.set(-.25,3.55,.55),a.add(u);const H=new THREE.BoxGeometry(1.2,.08,.08),P=new THREE.Mesh(H,p);P.position.set(0,3.6,.3),a.add(P)}else if(U==="round_glasses"){const m=new THREE.BoxGeometry(.9,.25,.1),p=new THREE.MeshStandardMaterial({color:14329120}),u=new THREE.Mesh(m,p);u.position.set(0,3.55,.55),a.add(u);const H=new THREE.BoxGeometry(.28,.28,.08),P=new THREE.MeshStandardMaterial({color:16777215,transparent:!0,opacity:.4}),N=new THREE.Mesh(H,P);N.position.set(-.25,3.55,.58),a.add(N);const ae=new THREE.Mesh(H,P);ae.position.set(.25,3.55,.58),a.add(ae)}}return a}function Dr(){[{x:-40,z:-30},{x:-50,z:20},{x:45,z:-40},{x:60,z:30},{x:-30,z:50},{x:35,z:55},{x:-60,z:-50},{x:70,z:-20},{x:-45,z:40},{x:55,z:45},{x:-70,z:10},{x:40,z:-60}].forEach(a=>{const d=Nr();d.position.set(a.x,0,a.z),ge.add(d)})}function Nr(){const c=new THREE.Group,a=new THREE.BoxGeometry(1.5,6,1.5),d=new THREE.MeshStandardMaterial({color:6964256}),w=new THREE.Mesh(a,d);w.position.y=3,w.castShadow=!0,c.add(w);const x=[2972205,3832378,4889162];for(let M=0;M<4;M++){const B=5-M*.8,S=new THREE.BoxGeometry(B,2,B),F=new THREE.MeshStandardMaterial({color:x[M%3]}),U=new THREE.Mesh(S,F);U.position.y=6+M*1.8,U.castShadow=!0,c.add(U);const Q=new THREE.BoxGeometry(B+.3,.4,B+.3),ie=new THREE.MeshStandardMaterial({color:16777215}),J=new THREE.Mesh(Q,ie);J.position.y=7+M*1.8,c.add(J)}return c}function Ur(){[{x:-35,z:-10},{x:40,z:10},{x:10,z:-35},{x:-10,z:40}].forEach(a=>{const d=Wr();d.position.set(a.x,0,a.z),d.rotation.y=Math.random()*Math.PI*2,ge.add(d)})}function Wr(){const c=new THREE.Group,a=new THREE.BoxGeometry(8,5,6),d=new THREE.MeshStandardMaterial({color:11034656}),w=new THREE.Mesh(a,d);w.position.y=2.5,w.castShadow=!0,w.receiveShadow=!0,c.add(w);const x=new THREE.BoxGeometry(9,1,7),M=new THREE.MeshStandardMaterial({color:12599360}),B=new THREE.Mesh(x,M);B.position.y=5.5,B.castShadow=!0,c.add(B);const S=new THREE.BoxGeometry(7,1,5),F=new THREE.Mesh(S,M);F.position.y=6.5,F.castShadow=!0,c.add(F);const U=new THREE.BoxGeometry(5,1,3),Q=new THREE.Mesh(U,M);Q.position.y=7.5,Q.castShadow=!0,c.add(Q);const ie=new THREE.MeshStandardMaterial({color:16777215}),J=new THREE.BoxGeometry(9.5,.5,7.5),ce=new THREE.Mesh(J,ie);ce.position.y=8,c.add(ce);const E=new THREE.BoxGeometry(1.5,3,.2),k=new THREE.MeshStandardMaterial({color:4861984}),R=new THREE.Mesh(E,k);R.position.set(0,1.5,3.1),c.add(R);const G=new THREE.BoxGeometry(1.2,1.2,.2),W=new THREE.MeshStandardMaterial({color:8965375,emissive:16777096,emissiveIntensity:.3}),$=new THREE.Mesh(G,W);$.position.set(-2.5,3,3.1),c.add($);const z=new THREE.Mesh(G,W);return z.position.set(2.5,3,3.1),c.add(z),c}function Vr(){const c=new THREE.BufferGeometry,a=2e3,d=new Float32Array(a*3);for(let M=0;M<a*3;M+=3)d[M]=(Math.random()-.5)*150,d[M+1]=Math.random()*50,d[M+2]=(Math.random()-.5)*150;c.setAttribute("position",new THREE.BufferAttribute(d,3));const w=new THREE.PointsMaterial({color:16777215,size:.3,transparent:!0,opacity:.8}),x=new THREE.Points(c,w);x.userData.velocities=[];for(let M=0;M<a;M++)x.userData.velocities.push({y:Math.random()*.02+.01,x:(Math.random()-.5)*.01});go.push(x),ge.add(x)}function Yr(){document.addEventListener("keydown",c=>{et[c.key.toLowerCase()]=!0,c.key.toLowerCase()==="e"&&dt&&!Se&&$r(dt),c.key===" "&&Se&&!Xe&&(c.preventDefault(),cn()),c.key==="Escape"&&document.getElementById("journalModal").classList.remove("active"),c.key.toLowerCase()==="f"&&(ln(),document.getElementById("journalModal").classList.add("active"))}),document.addEventListener("keyup",c=>{et[c.key.toLowerCase()]=!1,c.key===" "&&Se&&Xe&&(c.preventDefault(),Ct())}),document.addEventListener("click",c=>{Br(),!Se&&!c.target.closest(".journal-btn")&&!c.target.closest(".journal-modal")&&document.body.requestPointerLock()}),document.addEventListener("pointerlockchange",()=>{lo=document.pointerLockElement===document.body}),document.addEventListener("mousemove",c=>{lo&&!Se&&(Mo+=c.movementX*.002,Gt+=c.movementY*.002,Gt=Math.max(-Math.PI/3,Math.min(Math.PI/3,Gt)))})}function $r(c){Se=c.userData.dialogue,rt=c,rn=0,Ro(sn);const a=Math.atan2(c.position.x-A.position.x,c.position.z-A.position.z);A.rotation.y=a;const d=Math.atan2(A.position.x-c.position.x,A.position.z-c.position.z);c.rotation.y=d,document.getElementById("playerInfo").classList.add("hidden"),document.getElementById("miniMap").classList.add("hidden"),document.getElementById("controlsHint").classList.add("hidden"),document.getElementById("interactPrompt").classList.remove("active"),document.getElementById("journalBtn").classList.add("hidden");const w=document.getElementById("chatContainer");w.innerHTML="",document.getElementById("chatWrapper").classList.add("active"),document.getElementById("journalBtnChat").classList.add("active"),ve.position.clone(),To=!0,Xr(),document.exitPointerLock(),Kr();const x=document.getElementById("voicePrompt");x&&x.classList.add("active");const B=(c.userData.name||"Villager").split(" ")[0]||"Villager",S=localStorage.getItem("selectedCountry")||"Poland";let F="";S==="China"?F=`A realistic ${B} wearing traditional Chinese Hanfu clothing standing on the Great Wall of China, green mountains background, misty atmosphere, high quality`:S==="France"?F=`A realistic ${B} wearing 19th century French fashion standing near the Eiffel Tower in Paris, romantic atmosphere, high quality`:S==="Japan"?F=`A realistic ${B} wearing traditional Japanese Kimono standing near a Torii gate and cherry blossoms, Kyoto atmosphere, high quality`:F=`A realistic ${B} standing in front of a majestic Polish monument statue in Warsaw, winter atmosphere, high quality, detailed architecture`,pr(F,"gameCanvas")}function Xr(){const c=rt,a=new THREE.Vector3;a.copy(c.position),a.y=c.position.y+3.5;const d=new THREE.Vector3(0,0,1);d.applyAxisAngle(new THREE.Vector3(0,1,0),c.rotation.y),tt=a.clone(),tt.add(d.clone().multiplyScalar(2.5)),tt.y=a.y+1.2;const w=new THREE.Vector3(-1,0,0);w.applyAxisAngle(new THREE.Vector3(0,1,0),c.rotation.y),tt.add(w.multiplyScalar(.3)),At=a.clone()}function Kr(){if(!Se||rn>=Se.length)return;const c=Se[rn],a=document.getElementById("chatContainer"),d=document.createElement("div");d.className=`chat-bubble ${c.speaker}`;const w=c.speaker==="npc"?rt.userData.name:Pe.name||"Player";d.innerHTML=`
        <div class="speaker-name">${w}</div>
        <div class="message-text">${c.text}</div>
    `,a.appendChild(d),a.scrollTop=a.scrollHeight}function Jr(c){if(Se)return;const a=15,d=new THREE.Vector3,w=new THREE.Vector3;ve.getWorldDirection(w),w.y=0,w.normalize();const x=new THREE.Vector3;x.crossVectors(w,new THREE.Vector3(0,1,0)),et.w&&d.add(w),et.s&&d.sub(w),et.a&&d.sub(x),et.d&&d.add(x);const M=Hr();if(M.x!==0||M.y!==0){const B=w.clone().multiplyScalar(-M.y),S=x.clone().multiplyScalar(M.x);d.add(B),d.add(S)}d.length()>0&&(d.normalize(),A.position.add(d.multiplyScalar(a*c)),A.rotation.y=Math.atan2(d.x,d.z),Cr()),A.position.x=Math.max(-90,Math.min(90,A.position.x)),A.position.z=Math.max(-90,Math.min(90,A.position.z))}function Zr(){if(To&&tt&&At){ve.position.lerp(tt,.08);const c=new THREE.Vector3;ve.getWorldDirection(c),c.add(ve.position),c.lerp(At,.08),ve.lookAt(At)}else{const a=new THREE.Vector3(0,8,12).clone();a.applyAxisAngle(new THREE.Vector3(0,1,0),-Mo),ve.position.copy(A.position).add(a),ve.position.y=A.position.y+8-Gt*5,ve.lookAt(A.position.x,A.position.y+3,A.position.z)}}function Qr(){let c=null,a=1/0;vo.forEach(M=>{const B=A.position.distanceTo(M.position);if(B<10){const S=Math.atan2(A.position.x-M.position.x,A.position.z-M.position.z);M.rotation.y=S}B<5&&B<a&&(c=M,a=B)}),dt=c;const d=document.getElementById("interactPrompt"),w=dt&&!Se;w?(d.classList.add("active"),yo||Ro(an)):d.classList.remove("active"),yo=w,br()&&dt&&a<10?on(!0):on(!1)}function qr(c){go.forEach(a=>{const d=a.geometry.attributes.position.array,w=a.userData.velocities;for(let x=0;x<d.length;x+=3){const M=x/3;d[x]+=w[M].x,d[x+1]-=w[M].y,d[x+1]<0&&(d[x+1]=50,d[x]=(Math.random()-.5)*150,d[x+2]=(Math.random()-.5)*150)}a.geometry.attributes.position.needsUpdate=!0})}function Ho(){requestAnimationFrame(Ho);const c=xo.getDelta();Jr(c),Zr(),Qr(),qr(),qe.render(ge,ve)}let Le,pt=[],bo=0,Xe=!1;const ei=500;function ti(){const c=document.getElementById("micBtn");c&&(c.addEventListener("mousedown",cn),c.addEventListener("mouseup",Ct),c.addEventListener("mouseleave",Ct),c.addEventListener("touchstart",a=>{a.preventDefault(),cn()}),c.addEventListener("touchend",a=>{a.preventDefault(),Ct()}))}async function cn(){if(!rt||Xe)return;const c=document.getElementById("micBtn"),a=document.getElementById("recordingStatus"),d=document.getElementById("voicePrompt");try{const w=await navigator.mediaDevices.getUserMedia({audio:!0});let x="audio/webm";MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?x="audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/mp4")&&(x="audio/mp4"),Le=new MediaRecorder(w,{mimeType:x}),pt=[],bo=Date.now(),Xe=!0,Le.addEventListener("dataavailable",M=>{M.data.size>0&&pt.push(M.data)}),Le.addEventListener("stop",ni),Le.start(),c&&c.classList.add("recording"),a&&(a.classList.remove("hidden"),a.textContent="Recording..."),d&&(d.textContent="Listening...",d.style.color="#e74c3c",d.style.borderColor="#e74c3c")}catch(w){console.error("Error accessing microphone:",w),alert("Could not access microphone. Please allow permissions."),Xe=!1}}function Ct(){if(!Xe)return;const c=document.getElementById("micBtn"),a=document.getElementById("recordingStatus"),d=document.getElementById("voicePrompt");Le&&Le.state!=="inactive"&&(Date.now()-bo<ei?(Le.stop(),pt=[],console.log("Recording too short, cancelled.")):Le.stop(),Le.stream.getTracks().forEach(x=>x.stop())),Xe=!1,c&&c.classList.remove("recording"),a&&a.classList.add("hidden"),d&&(d.textContent="Hold SPACE to Speak",d.style.color="#f8e038",d.style.borderColor="#f8e038")}async function ni(){if(!rt||pt.length===0)return;const c=Le.mimeType;let a="webm";c.includes("mp4")&&(a="m4a"),c.includes("mpeg")&&(a="mp3"),c.includes("wav")&&(a="wav");const d=new Blob(pt,{type:c});console.log(`Sending audio: ${d.size} bytes, type: ${c}`);const w=new FormData;w.append("audio",d,`recording.${a}`);const x=rt.userData.name,M=x.toLowerCase().replace(" ","_");w.append("npc_id",M);const B=document.getElementById("chatContainer"),S=document.createElement("div");S.className="chat-bubble player",S.innerHTML='<div class="message-text">...</div>',B.appendChild(S),B.scrollTop=B.scrollHeight;try{const F=await fetch("http://localhost:8000/api/conversation/respond",{method:"POST",body:w});if(!F.ok){const Q=await F.json();throw new Error(Q.detail||"Server error")}const U=await F.json();if(S.parentNode&&B.removeChild(S),U.transcription){const Q=document.createElement("div");Q.className="chat-bubble player",Q.innerHTML=`
                <div class="speaker-name">${Pe.name||"Player"}</div>
                <div class="message-text">${U.transcription}</div>
            `,B.appendChild(Q)}if(U.response){const Q=document.createElement("div");Q.className="chat-bubble npc",Q.innerHTML=`
                <div class="speaker-name">${x}</div>
                <div class="message-text">${U.response}</div>
            `,B.appendChild(Q),U.audio_url&&new Audio("http://localhost:8000"+U.audio_url).play().catch(J=>console.error("Audio play error:",J))}B.scrollTop=B.scrollHeight}catch(F){console.error("Error sending audio:",F),S.innerHTML=`<div class="message-text" style="color:red">${F.message}</div>`}}
